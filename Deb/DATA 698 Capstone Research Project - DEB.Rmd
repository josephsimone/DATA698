---
title: 'DATA 698 : Capstone Research Project'
subtitle: Capstone Project on CPI and Employment
author: "Debabrata Kabiraj, Joseph Simone and Rajwant Mishra"
date: "Oct 1, 2020"
output: 
  rmdformats::readthedown:
    number_sections: true # if you want number sections at each table header
    smooth_scroll: true
    theme: united # many options for theme, this one is my favorite.
    highlight: tango # specifies the syntax highlighting style
   #toc: true # table of content true
    toc_collapsed : true
    toc_float: true
    toc_depth: 5
    code_folding: hide
    df_print: paged
---

# Overview

We are in totally different era of twenty first century, and it gives us very rare situation where any positive news would help the humankind. We want to use the historical CPI data and find the relation of it with the employment, in hope that we would have some positive news on employment by following the trend of the data in past.  

We feel that lower CPI would result in more job opportunity, as the it gives space for more competition in small business across sectors.   
 
# Capstone Project on CPI and Employment

1. The estimates of employment for 1998-2006 are based on the 2002 North American Industry Classification System (NAICS). The estimates for 2007-2010 are based on the 2007 NAICS. The estimates for 2011-2016 are based on the 2012 NAICS. The estimates for 2017 forward are based on the 2017 NAICS.
2. Excludes limited partners.
3. Under the 2007 NAICS, internet publishing and broadcasting was reclassified to other information services.

- (NA) Not available.
- (NM) Not meaningful.
- (D) Not shown to avoid disclosure of confidential information; estimates are included in higher-level totals.
- (T) Estimate for employment suppressed to cover corresponding estimate for earnings. Estimates for this item are included in the total.

Last updated: September 24, 2019- new statistics for 2018; revised statistics for 2014-2017.

# Data Preparation

Load the required libraries
```{r message=FALSE, warning=FALSE}
#packages <- c("R.rsp","pandocfilters","knitr","plyr","tidyr","dplyr","ggplot2","plotly","sqldf","MASS","reshape2","Amelia","mice","googleVis","stringi","ROCR","scatterplot3d","visdat","gridExtra","sjmisc", "devtools")
#install.packages (packages, repos="http://cran.us.r-project.org", dependencies=TRUE, lib="C:/Program Files/R/R-3.6.3/library")
#invisible (lapply (packages, library, character.only = T))
#devtools::install_github("hadley/ggplot2")

#if (!require(devtools)) install.packages("devtools", repos="http://cran.us.r-project.org", dependencies=TRUE, lib="C:/Program Files/R/R-3.6.3/library")
#devtools::install_github("boxuancui/DataExplorer")
#library("DataExplorer", lib.loc="C:/Program Files/R/R-3.6.3/library")

library(tidyverse)
library(kableExtra)
library(lubridate)
library(forecast)
library(stringi)
library(dplyr)
```

## Load Employment Datasets
```{r load-sainc-files, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
file_path <- "../data/cpi/SAINC/"

EMP_DATA_FILE <- paste0(file_path,"EMP9818.csv")
EMP_DATA <- read_delim(EMP_DATA_FILE, delim = ",", col_names = TRUE, trim_ws= TRUE) 
#,skip = 6,col_types = list(col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character()))
# names(SAP_INV_DAT) = c("DROP","I_BILLDATE","I_ORG","I_DC","I_DOCCA","I_BILLTYPE","I_ORDER_REA","I_DIV","I_MATYPE","I_BILL_QTY","BLANK")
# SAP_INV_DAT<- SAP_INV_DAT[-which(is.na(SAP_INV_DAT$I_ORG)),] %>% .[-str_which(trimws(.$I_ORG),'SOrg.|-----'),c(-1,-11)]
# 3
# SAP_INV_DAT$I_BILLDATE <- date(parse_datetime(SAP_INV_DAT$I_BILLDATE, "%m/%d/%Y"))
# 
# head(SAP_INV_DAT)
summary(EMP_DATA)
DT::datatable(EMP_DATA)

# Reading the Category and detail Desc for ref.
EMP_DEF_FILE <- paste0(file_path,"SAEMP25N__definition.xml")
IND_DESC <- XML::xmlToDataFrame(EMP_DEF_FILE)
names(IND_DESC) <- c("LineCode","Description")
glimpse(IND_DESC)
head(IND_DESC,5)
```

## Show Relevant Employment Data
```{r emp-data, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# MN-MAIN  | NN - RANGE  | NL - LAST |
EMAP_CAT_LAST <- EMP_DATA[,c(2,5,6,7)] %>% 
                  filter(GeoName=="United States") %>% 
                  mutate(ISM = ifelse(IndustryClassification=="...","M","N")) %>% 
                  separate(IndustryClassification, c("From", "To"))  %>% 
                  mutate(ISML = ifelse(is.na(To)==T,"L","N")) %>% 
                  filter(ISML %in% c("L","N")) %>%  
                  select(.,LineCode,Description)
#DT::datatable(EMAP_CAT_LAST)

EMP_DAT_CAT <- EMP_DATA[,c(2,5,9:29)] %>% 
                left_join(EMAP_CAT_LAST,.,by="LineCode")
glimpse(EMP_DAT_CAT)
head(EMP_DAT_CAT,130)
#DT::datatable(EMP_DAT_CAT)

temp_name <- names(EMP_DAT_CAT [,c(4:24)])
EMP_DAT_CAT_SAN <-  data.frame(lapply(EMP_DAT_CAT [,c(4:24)],function(x) {
                      gsub("(D)|(T)",NA,x)
                    })) 
names(EMP_DAT_CAT_SAN) = temp_name
#DT::datatable(EMP_DAT_CAT_SAN)

EMP_DAT_CAT_SAN <- cbind(EMP_DAT_CAT[,c(1:3)],EMP_DAT_CAT_SAN)
#DT::datatable(EMP_DAT_CAT_SAN)
```

### Employment from Select Industry by State

#### AK - Alaska
```{r emp-data-ak, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_AK <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Alaska") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_AK %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### AZ - Arizona
```{r emp-data-az, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_AZ <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Arizona") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_AZ %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### CA - California
```{r emp-data-ca, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_CA <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="California") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_CA %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### CO - Colorado
```{r emp-data-co, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_CO <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Colorado") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_CO %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### FL - Florida
```{r emp-data-fl, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_FL <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Florida") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_FL %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### GA - Georgia
```{r emp-data-ga, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_GA <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Georgia") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_GA %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### HI - Hawaii
```{r emp-data-hi, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_HI <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Hawaii") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_HI %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### IL - Illinois
```{r emp-data-il, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_IL <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Illinois") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_IL %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### KS - Kansas
```{r emp-data-ks, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_KS <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Kansas") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_KS %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### MA - Massachusetts
```{r emp-data-ma, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_MA <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Massachusetts") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_MA %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### MI - Michigan
```{r emp-data-mi, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_MI <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Michigan") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_MI %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### MN - Minnesota
```{r emp-data-mn, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_MN <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Michigan") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_MN %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### MO - Missouri
```{r emp-data-mo, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_MO <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Missouri") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_MO %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### NY - New York
```{r emp-data-ny, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_NY <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="New York") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_NY %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### OH - Ohio
```{r emp-data-oh, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_OH <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Ohio") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_OH %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### OR - Oregon
```{r emp-data-or, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_OR <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Oregon") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_OR %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### PA - Pennsylvania
```{r emp-data-pa, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_PA <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Pennsylvania") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_PA %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### TX - Texas
```{r emp-data-tx, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_TX <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Texas") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_TX %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### WA - Washington
```{r emp-data-wa, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_WA <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Washington") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_WA %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### WI - Wisconsin
```{r emp-data-wi, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_WI <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Wisconsin") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_WI %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

## Load CPI Data

```{r load-cu-files, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
file_path <- "../data/cpi/archive/"

### Read files named *.csv
filenames <- list.files(path=file_path,
                        pattern="*.csv",
                        full.names = TRUE)
###print(filenames)

###Create list of data frame names without the ".csv" part 
names <- gsub(pattern='\\.', 
              replacement='_', # remove the last 4 characters from filename (_clean)
              x=(sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                    basename(filenames) # get filename without the directory file path
                   )
                 )
              )
###print(names)

###Load all files
for(i in filenames){
  ## Create list of data frame names without the ".csv" part 
  name <- gsub(pattern='\\.', 
               replacement='_', # remove the last 4 characters from filename (_clean)
               x=(sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                      basename(i) # get filename without the directory file path
                     )
                 )
              )
   print(name)
   assign(x=name, value=data.frame(read.csv(i)))
   #DT::datatable(name)
}
```

## Show CPI Reference Data

### Area
```{r show_area, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_area)
```

### Base
```{r show_base, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_base)
```

### Item
```{r show_item, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_item)
```

### Periodicity
```{r show_periodicity, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_periodicity)
```

### Series
```{r show_series, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_series)
```

### Period
```{r show_period, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_period)
```

### Combined Reference Data
```{r show_references, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_reference_data = cu_series %>% 
                    inner_join(cu_area, by="area_code") %>% 
                    inner_join(cu_item, by="item_code") %>% 
                    inner_join(cu_periodicity, by="periodicity_code") %>% 
                    inner_join(cu_base, by="base_code")

colnames(cu_reference_data)[which(names(cu_reference_data) == "display_level.x")] <- "area_display_level"
colnames(cu_reference_data)[which(names(cu_reference_data) == "selectable.x")] <- "area_selectable"
colnames(cu_reference_data)[which(names(cu_reference_data) == "sort_sequence.x")] <- "area_sort_sequence"
colnames(cu_reference_data)[which(names(cu_reference_data) == "display_level.y")] <- "item_display_level"
colnames(cu_reference_data)[which(names(cu_reference_data) == "selectable.y")] <- "item_selectable"
colnames(cu_reference_data)[which(names(cu_reference_data) == "sort_sequence.y")] <- "item_sort_sequence"

cu_reference_data <- cu_reference_data[c("series_id",
                                         "series_title",
                                         "area_code",
                                         "area_name",
                                         "area_display_level",
                                         "area_selectable",
                                         "area_sort_sequence",
                                         "item_code",
                                         "item_name",
                                         "item_display_level",
                                         "item_selectable",
                                         "item_sort_sequence",
                                         "seasonal",
                                         "periodicity_code",
                                         "periodicity_name",
                                         "base_code",
                                         "base_name",
                                         "base_period")]
DT::datatable(cu_reference_data)
```

## Show CPI Data from Select Industry

### CPI - US Food Beverages
```{r USFoodBeverage, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
FoodItemCode <- cu_reference_data %>%
                    filter(grepl('SAF|SEF|SS0|SS1|SS20', item_code))
                    #dplyr::filter(item_code %like% 'SAH' | item_code %like% 'SEH')
#DT::datatable((FoodItemCode))

cu_data_USFoodBeverage = cu_data_0_Current %>% 
                              inner_join(FoodItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USFoodBeverage))
```

### CPI - US Housing
```{r USHousing, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
HousingItemCode <- cu_reference_data %>%
                    #filter(grepl('SAH|SEH', item_code, fixed = TRUE))
                    filter(grepl('SAH|SEH', item_code))
                    #dplyr::filter(item_code %like% 'SAH' | item_code %like% 'SEH')
#DT::datatable((HousingItemCode))

cu_data_USHousing = cu_data_0_Current %>% 
                              inner_join(HousingItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               #filter(item_code %like% c('SAH','SEH')) %>%
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USHousing))
```

### CPI - US Transportation
```{r USTransportation, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
TransportItemCode <- cu_reference_data %>%
                    filter(grepl('SAT|SET|SS4|SS52|SS53|SAS24|SAS4', item_code))

cu_data_USTransportation = cu_data_0_Current %>% 
                              inner_join(TransportItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USTransportation))
```

### CPI - US Medical
```{r USMedical, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
MedicalItemCode <- cu_reference_data %>%
                    filter(grepl('SAM|SEM|SS57', item_code))

cu_data_USMedical = cu_data_0_Current %>% 
                              inner_join(MedicalItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USMedical))
```

### CPI - US Education And Communication
```{r USEducationAndCommunication, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EducationItemCode <- cu_reference_data %>%
                    filter(grepl('SAE|SEE|SSE|SS27', item_code))

cu_data_USEducationAndCommunication = cu_data_0_Current %>% 
                                        inner_join(EducationItemCode, by="series_id") %>% 
                                        inner_join(cu_period, by="period") %>% 
                                         filter(year %in% (1998:2018)) %>% 
                                         select(c("series_id",
                                                  "series_title",
                                                  "year",
                                                  "period",
                                                  "period_abbr",
                                                  "period_name",
                                                  "value",
                                                  "area_code",
                                                  "area_name",
                                                  "area_display_level",
                                                  "area_selectable",
                                                  "area_sort_sequence",
                                                  "item_code",
                                                  "item_name",
                                                  "item_display_level",
                                                  "item_selectable",
                                                  "item_sort_sequence",
                                                  "seasonal",
                                                  "periodicity_code",
                                                  "periodicity_name",
                                                  "base_code",
                                                  "base_name",
                                                  "base_period"))
DT::datatable(head(cu_data_USEducationAndCommunication))
```

# Employment vs CPI - by Industry and Area

## Food & Beverages

### AK - Alaska : Anchorage
```{r CpiEmpFoodBeverageAK, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_AK = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Anchorage", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'AK') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_AK = merge(EMP_DAT_CAT_SAN_AK, cu_emp_data_USFoodBeverage_AK, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_AK %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### AZ - Arizona : Phoenix-Mesa
```{r CpiEmpFoodBeverageAZ, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_AZ = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Phoenix-Mesa", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'AZ') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_AZ = merge(EMP_DAT_CAT_SAN_AZ, cu_emp_data_USFoodBeverage_AZ, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_AZ %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### CA - California
- Los Angeles-Riverside-Orange County
- San Francisco-Oakland-San Jose
- San Diego

```{r CpiEmpFoodBeverageCA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_CA = cu_data_USFoodBeverage %>% 
                                   filter( (area_name %in% c("Los Angeles-Riverside-Orange County", "San Francisco-Oakland-San Jose")
                                            & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                            )
                                           |
                                            (area_name %in% c("San Diego")
                                             & period %in% c("S01","S02")
                                             )
                                         ) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         area_code = 'A421;A422;A424',
                                         area_name = 'Los Angeles-Riverside-Orange County;San Francisco-Oakland-San Jose;San Diego',
                                         industry = 'Food & Beverages',
                                         state = 'CA') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value/3),2))

cpi_emp_data_USFoodBeverage_CA = merge(EMP_DAT_CAT_SAN_CA, cu_emp_data_USFoodBeverage_CA, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_CA %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### CO - Colorado : Denver-Boulder-Greeley
```{r CpiEmpFoodBeverageCO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_CO = cu_data_USFoodBeverage %>% 
                                  filter(area_name %in% c("Denver-Boulder-Greeley"), 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'CO') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_CO = merge(EMP_DAT_CAT_SAN_CO, cu_emp_data_USFoodBeverage_CO, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_CO %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### FL - Florida
- Miami-Fort Lauderdale
- Tampa-St. Petersburg-Clearwater

```{r CpiEmpFoodBeverageFL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_FL = cu_data_USFoodBeverage %>% 
                                  filter( (area_name %in% c("Miami-Fort Lauderdale")
                                          & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                          )
                                         |
                                          (area_name %in% c("Tampa-St. Petersburg-Clearwater")
                                           & period %in% c("S01","S02")
                                           )
                                       ) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         area_code = 'A320;A321',
                                         area_name = 'Miami-Fort Lauderdale;Tampa-St. Petersburg-Clearwater',
                                         industry = 'Food & Beverages',
                                         state = 'FL') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USFoodBeverage_FL = merge(EMP_DAT_CAT_SAN_FL, cu_emp_data_USFoodBeverage_FL, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_FL %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### GA - Georgia : Atlanta
```{r CpiEmpFoodBeverageGA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_GA = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Atlanta", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(industry = 'Food & Beverages',
                                         state = 'GA',
                                         parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'GA') %>% 
                                   select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_GA = merge(EMP_DAT_CAT_SAN_GA, cu_emp_data_USFoodBeverage_GA, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_GA %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### HI - Hawaii : Honolulu
```{r CpiEmpFoodBeverageHI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_HI = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Honolulu", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(industry = 'Food & Beverages',
                                         state = 'HI',
                                         parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'HI') %>% 
                                   select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_HI = merge(EMP_DAT_CAT_SAN_HI, cu_emp_data_USFoodBeverage_HI, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_HI %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### IL - Illinois : Chicago-Gary-Kenosha
```{r CpiEmpFoodBeverageIL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_IL = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Chicago-Gary-Kenosha", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(industry = 'Food & Beverages',
                                         state = 'IL',
                                         parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'IL') %>% 
                                   select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_IL = merge(EMP_DAT_CAT_SAN_IL, cu_emp_data_USFoodBeverage_IL, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_IL %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### KS - Kansas : Kansas City
```{r CpiEmpFoodBeverageKS, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_KS = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Kansas City", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(industry = 'Food & Beverages',
                                         state = 'KS',
                                         parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'KS') %>% 
                                   select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_KS = merge(EMP_DAT_CAT_SAN_KS, cu_emp_data_USFoodBeverage_KS, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_KS %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### MA - Massachusetts : Boston-Brockton-Nashua
```{r CpiEmpFoodBeverageMA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_MA = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Boston-Brockton-Nashua", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'MA') %>% 
                                   select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_MA = merge(EMP_DAT_CAT_SAN_MA, cu_emp_data_USFoodBeverage_MA, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_MA %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan : Detroit-Ann Arbor-Flint
```{r CpiEmpFoodBeverageMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_MI = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Detroit-Ann Arbor-Flint", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'MI') %>% 
                                   select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USFoodBeverage_MI, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_MI %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### MN - Minnesota : Minneapolis-St. Paul
```{r CpiEmpFoodBeverageMN, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_MN = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Minneapolis-St. Paul", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'MN') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_MN = merge(EMP_DAT_CAT_SAN_MN, cu_emp_data_USFoodBeverage_MN, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_MN %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### MO - Missouri : St. Louis
```{r CpiEmpFoodBeverageMO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_MO = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="St. Louis", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'MO') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_MO = merge(EMP_DAT_CAT_SAN_MO, cu_emp_data_USFoodBeverage_MO, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_MO %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### NY - New York : New York-Northern New Jersey-Long Island
```{r CpiEmpFoodBeverageNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_NY = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="New York-Northern New Jersey-Long Island", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'NY') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USFoodBeverage_NY, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_NY %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### OH - Ohio
- Cleveland-Akron
- Cincinnati-Hamilton

```{r CpiEmpFoodBeverageOH, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_OH = cu_data_USFoodBeverage %>% 
                                  filter( (area_name %in% c("Cleveland-Akron")
                                          & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                          )
                                         |
                                          (area_name %in% c("Cincinnati-Hamilton")
                                           & period %in% c("S01","S02")
                                           )
                                       ) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         area_code = 'A210;A213', 
                                         area_name = 'Cleveland-Akron;Cincinnati-Hamilton',
                                         industry = 'Food & Beverages',
                                         state = 'OH') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USFoodBeverage_OH = merge(EMP_DAT_CAT_SAN_OH, cu_emp_data_USFoodBeverage_OH, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_OH %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon : Portland-Salem
```{r CpiEmpFoodBeverageOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_OR = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Portland-Salem", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'OR') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USFoodBeverage_OR, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_OR %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### PA - Pennsylvania
- Philadelphia-Wilmington-Atlantic City
- Pittsburgh

```{r CpiEmpFoodBeveragePA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_PA = cu_data_USFoodBeverage %>% 
                                  filter( (area_name %in% c("Philadelphia-Wilmington-Atlantic City")
                                          & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                          )
                                         |
                                          (area_name %in% c("Pittsburgh")
                                           & period %in% c("S01","S02")
                                           )
                                       ) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         area_code = 'A102;A104', 
                                         area_name = 'Philadelphia-Wilmington-Atlantic City;Pittsburgh',
                                         industry = 'Food & Beverages',
                                         state = 'PA') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USFoodBeverage_PA = merge(EMP_DAT_CAT_SAN_PA, cu_emp_data_USFoodBeverage_PA, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_PA %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### TX - Texas
- Dallas-Fort Worth
- Houston-Galveston-Brazoria

```{r CpiEmpFoodBeverageTX, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_TX = cu_data_USFoodBeverage %>% 
                                  filter(area_name %in% c("Dallas-Fort Worth","Houston-Galveston-Brazoria"), 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         area_code = 'A316;A318', 
                                         area_name = 'Dallas-Fort Worth;Houston-Galveston-Brazoria',
                                         industry = 'Food & Beverages',
                                         state = 'TX') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USFoodBeverage_TX = merge(EMP_DAT_CAT_SAN_TX, cu_emp_data_USFoodBeverage_TX, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_TX %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### WA - Washington : Seattle-Tacoma-Bremerton
```{r CpiEmpFoodBeverageWA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_WA = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Seattle-Tacoma-Bremerton", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'WA') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_WA = merge(EMP_DAT_CAT_SAN_WA, cu_emp_data_USFoodBeverage_WA, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_WA %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### WI - Wisconsin : Milwaukee-Racine
```{r CpiEmpFoodBeverageWI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_WI = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Milwaukee-Racine", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705,
                                         industry = 'Food & Beverages',
                                         state = 'WI') %>% 
                                  select(c("industry",
                                            "state",
                                            "parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USFoodBeverage_WI = merge(EMP_DAT_CAT_SAN_WI, cu_emp_data_USFoodBeverage_WI, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_WI %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

## Housing

### AK - Alaska : Anchorage
```{r CpiEmpHousingAK, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_AK = cu_data_USHousing  %>% 
                            filter(area_name=="Anchorage", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'AK') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_AK = merge(EMP_DAT_CAT_SAN_AK, cu_emp_data_USHousing_AK, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_AK %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### AZ - Arizona : Phoenix-Mesa
```{r CpiEmpHousingAZ, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_AZ = cu_data_USHousing  %>% 
                            filter(area_name=="Phoenix-Mesa", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'AZ') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_AZ = merge(EMP_DAT_CAT_SAN_AZ, cu_emp_data_USHousing_AZ, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_AZ %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### CA - California
- Los Angeles-Riverside-Orange County
- San Francisco-Oakland-San Jose
- San Diego

```{r CpiEmpHousingCA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_CA = cu_data_USHousing  %>% 
                            filter( (area_name %in% c("Los Angeles-Riverside-Orange County", "San Francisco-Oakland-San Jose")
                                      & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                      )
                                     |
                                      (area_name %in% c("San Diego")
                                       & period %in% c("S01","S02")
                                       )
                                   ) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   area_code = 'A421;A422;A424',
                                   area_name = 'Los Angeles-Riverside-Orange County;San Francisco-Oakland-San Jose;San Diego',
                                   industry = 'Housing',
                                   state = 'CA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value/3),2))

cpi_emp_data_USHousing_CA = merge(EMP_DAT_CAT_SAN_CA, cu_emp_data_USHousing_CA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_CA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### CO - Colorado : Denver-Boulder-Greeley
```{r CpiEmpHousingCO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_CO = cu_data_USHousing  %>% 
                            filter(area_name=="Denver-Boulder-Greeley", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'CO') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_CO = merge(EMP_DAT_CAT_SAN_CO, cu_emp_data_USHousing_CO, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_CO %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### FL - Florida
- Miami-Fort Lauderdale
- Tampa-St. Petersburg-Clearwater

```{r CpiEmpHousingFL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_FL = cu_data_USHousing  %>% 
                            filter( (area_name %in% c("Miami-Fort Lauderdale")
                                    & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                    )
                                   |
                                    (area_name %in% c("Tampa-St. Petersburg-Clearwater")
                                     & period %in% c("S01","S02")
                                     )
                                 ) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   area_code = 'A320;A321',
                                   area_name = 'Miami-Fort Lauderdale;Tampa-St. Petersburg-Clearwater',
                                   industry = 'Housing',
                                   state = 'FL') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USHousing_FL = merge(EMP_DAT_CAT_SAN_FL, cu_emp_data_USHousing_FL, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_FL %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### GA - Georgia : Atlanta
```{r CpiEmpHousingGA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_GA = cu_data_USHousing  %>% 
                            filter(area_name=="Atlanta", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'GA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_GA = merge(EMP_DAT_CAT_SAN_GA, cu_emp_data_USHousing_GA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_GA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### HI - Hawaii : Honolulu
```{r CpiEmpHousingHI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_HI = cu_data_USHousing  %>% 
                            filter(area_name=="Honolulu", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'HI') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_HI = merge(EMP_DAT_CAT_SAN_HI, cu_emp_data_USHousing_HI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_HI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### IL - Illinois : Chicago-Gary-Kenosha
```{r CpiEmpHousingIL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_IL = cu_data_USHousing  %>% 
                            filter(area_name=="Chicago-Gary-Kenosha", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'IL') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_IL = merge(EMP_DAT_CAT_SAN_IL, cu_emp_data_USHousing_IL, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_IL %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### KS - Kansas : Kansas City
```{r CpiEmpHousingKS, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_KS = cu_data_USHousing  %>% 
                            filter(area_name=="Kansas City", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'KS') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_KS = merge(EMP_DAT_CAT_SAN_KS, cu_emp_data_USHousing_KS, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_KS %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MA - Massachusetts : Boston-Brockton-Nashua
```{r CpiEmpHousingMA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_MA = cu_data_USHousing  %>% 
                            filter(area_name=="Boston-Brockton-Nashua", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'MA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_MA = merge(EMP_DAT_CAT_SAN_MA, cu_emp_data_USHousing_MA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_MA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan
```{r CpiEmpHousingMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_MI = cu_data_USHousing  %>% 
                            filter(area_name=="Detroit-Ann Arbor-Flint", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'MI') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USHousing_MI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MN - Minnesota : Minneapolis-St. Paul
```{r CpiEmpHousingMN, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_MN = cu_data_USHousing  %>% 
                            filter(area_name=="Minneapolis-St. Paul", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'MN') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_MN = merge(EMP_DAT_CAT_SAN_MN, cu_emp_data_USHousing_MN, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_MN %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MO - Missouri : St. Louis
```{r CpiEmpHousingMO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_MO = cu_data_USHousing  %>% 
                            filter(area_name=="St. Louis", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'MO') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_MO = merge(EMP_DAT_CAT_SAN_MO, cu_emp_data_USHousing_MO, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_MO %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### NY - New York : New York-Northern New Jersey-Long Island
```{r CpiEmpHousingNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_NY = cu_data_USHousing  %>% 
                            filter(area_name=="New York-Northern New Jersey-Long Island", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'NY') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USHousing_NY, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OH - Ohio
- Cleveland-Akron
- Cincinnati-Hamilton

```{r CpiEmpHousingOH, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_OH = cu_data_USHousing  %>% 
                                  filter( (area_name %in% c("Cleveland-Akron")
                                          & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                          )
                                         |
                                          (area_name %in% c("Cincinnati-Hamilton")
                                           & period %in% c("S01","S02")
                                           )
                                       ) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   area_code = 'A210;A213', 
                                   area_name = 'Cleveland-Akron;Cincinnati-Hamilton',
                                   industry = 'Housing',
                                   state = 'OH') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USHousing_OH = merge(EMP_DAT_CAT_SAN_OH, cu_emp_data_USHousing_OH, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_OH %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon : Portland-Salem
```{r CpiEmpHousingOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_OR = cu_data_USHousing  %>% 
                            filter(area_name=="Portland-Salem", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'OR') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USHousing_OR, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### PA - Pennsylvania
- Philadelphia-Wilmington-Atlantic City
- Pittsburgh

```{r CpiEmpHousingPA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_PA = cu_data_USHousing  %>% 
                            filter( (area_name %in% c("Philadelphia-Wilmington-Atlantic City")
                                    & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                    )
                                   |
                                    (area_name %in% c("Pittsburgh")
                                     & period %in% c("S01","S02")
                                     )
                                 ) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   area_code = 'A102;A104', 
                                   area_name = 'Philadelphia-Wilmington-Atlantic City;Pittsburgh',
                                   industry = 'Housing',
                                   state = 'PA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USHousing_PA = merge(EMP_DAT_CAT_SAN_PA, cu_emp_data_USHousing_PA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_PA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### TX - Texas
- Dallas-Fort Worth
- Houston-Galveston-Brazoria

```{r CpiEmpHousingTX, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_TX = cu_data_USHousing  %>% 
                            filter(area_name %in% c("Dallas-Fort Worth","Houston-Galveston-Brazoria"), 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   area_code = 'A316;A318', 
                                   area_name = 'Dallas-Fort Worth;Houston-Galveston-Brazoria',
                                   industry = 'Housing',
                                   state = 'TX') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USHousing_TX = merge(EMP_DAT_CAT_SAN_TX, cu_emp_data_USHousing_TX, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_TX %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WA - Washington : Seattle-Tacoma-Bremerton
```{r CpiEmpHousingWA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_WA = cu_data_USHousing  %>% 
                            filter(area_name=="Seattle-Tacoma-Bremerton", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'WA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_WA = merge(EMP_DAT_CAT_SAN_WA, cu_emp_data_USHousing_WA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_WA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WI - Wisconsin : Milwaukee-Racine
```{r CpiEmpHousingWI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_WI = cu_data_USHousing  %>% 
                            filter(area_name=="Milwaukee-Racine", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100,
                                   industry = 'Housing',
                                   state = 'WI') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USHousing_WI = merge(EMP_DAT_CAT_SAN_WI, cu_emp_data_USHousing_WI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_WI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Transportation

### AK - Alaska	: Anchorage
```{r CpiEmpTransportationAK, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_AK = cu_data_USTransportation %>% 
                                    filter(area_name=="Anchorage", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'AK') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_AK = merge(EMP_DAT_CAT_SAN_AK, cu_emp_data_USTransportation_AK, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_AK %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### AZ - Arizona : Phoenix-Mesa
```{r CpiEmpTransportationAZ, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_AZ = cu_data_USTransportation %>% 
                                    filter(area_name=="Phoenix-Mesa", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'AZ') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_AZ = merge(EMP_DAT_CAT_SAN_AZ, cu_emp_data_USTransportation_AZ, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_AZ %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### CA - California
- Los Angeles-Riverside-Orange County
- San Francisco-Oakland-San Jose
- San Diego

```{r CpiEmpTransportationCA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_CA = cu_data_USTransportation %>% 
                                   filter( (area_name %in% c("Los Angeles-Riverside-Orange County", "San Francisco-Oakland-San Jose")
                                            & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                            )
                                           |
                                            (area_name %in% c("San Diego")
                                             & period %in% c("S01","S02")
                                             )
                                         ) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           area_code = 'A421;A422;A424',
                                           area_name = 'Los Angeles-Riverside-Orange County;San Francisco-Oakland-San Jose;San Diego',
                                           industry = 'Transportation',
                                           state = 'CA') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value/3),2))

cpi_emp_data_USTransportation_CA = merge(EMP_DAT_CAT_SAN_CA, cu_emp_data_USTransportation_CA, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_CA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### CO - Colorado : Denver-Boulder-Greeley
```{r CpiEmpTransportationCO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_CO = cu_data_USTransportation %>% 
                                    filter(area_name=="Denver-Boulder-Greeley", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'CO') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_CO = merge(EMP_DAT_CAT_SAN_CO, cu_emp_data_USTransportation_CO, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_CO %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### FL - Florida
- Miami-Fort Lauderdale
- Tampa-St. Petersburg-Clearwater

```{r CpiEmpTransportationFL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_FL = cu_data_USTransportation %>% 
                                    filter( (area_name %in% c("Miami-Fort Lauderdale")
                                            & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                            )
                                           |
                                            (area_name %in% c("Tampa-St. Petersburg-Clearwater")
                                             & period %in% c("S01","S02")
                                             )
                                         ) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           area_code = 'A320;A321',
                                           area_name = 'Miami-Fort Lauderdale;Tampa-St. Petersburg-Clearwater',
                                           industry = 'Transportation',
                                           state = 'FL') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USTransportation_FL = merge(EMP_DAT_CAT_SAN_FL, cu_emp_data_USTransportation_FL, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_FL %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### GA - Georgia : Atlanta
```{r CpiEmpTransportationGA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_GA = cu_data_USTransportation %>% 
                                    filter(area_name=="Atlanta", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'GA') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_GA = merge(EMP_DAT_CAT_SAN_GA, cu_emp_data_USTransportation_GA, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_GA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### HI - Hawaii : Honolulu
```{r CpiEmpTransportationHI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_HI = cu_data_USTransportation %>% 
                                    filter(area_name=="Honolulu", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'HI') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_HI = merge(EMP_DAT_CAT_SAN_HI, cu_emp_data_USTransportation_HI, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_HI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### IL - Illinois : Chicago-Gary-Kenosha
```{r CpiEmpTransportationIL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_IL = cu_data_USTransportation %>% 
                                    filter(area_name=="Chicago-Gary-Kenosha", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'IL') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_IL = merge(EMP_DAT_CAT_SAN_IL, cu_emp_data_USTransportation_IL, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_IL %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### KS - Kansas : Kansas City
```{r CpiEmpTransportationKS, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_KS = cu_data_USTransportation %>% 
                                    filter(area_name=="Kansas City", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'KS') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_KS = merge(EMP_DAT_CAT_SAN_KS, cu_emp_data_USTransportation_KS, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_KS %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MA - Massachusetts : Boston-Brockton-Nashua
```{r CpiEmpTransportationMA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_MA = cu_data_USTransportation %>% 
                                    filter(area_name=="Boston-Brockton-Nashua", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'MA') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_MA = merge(EMP_DAT_CAT_SAN_MA, cu_emp_data_USTransportation_MA, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_MA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan : Detroit-Ann Arbor-Flint
```{r CpiEmpTransportationMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_MI = cu_data_USTransportation %>% 
                                    filter(area_name=="Detroit-Ann Arbor-Flint", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'MI') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USTransportation_MI, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MN - Minnesota : Minneapolis-St. Paul
```{r CpiEmpTransportationMN, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_MN = cu_data_USTransportation %>% 
                                    filter(area_name=="Minneapolis-St. Paul", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'MN') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_MN = merge(EMP_DAT_CAT_SAN_MN, cu_emp_data_USTransportation_MN, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_MN %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MO - Missouri : St. Louis
```{r CpiEmpTransportationMS, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_MO = cu_data_USTransportation %>% 
                                    filter(area_name=="St. Louis", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'MO') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_MO = merge(EMP_DAT_CAT_SAN_MO, cu_emp_data_USTransportation_MO, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_MO %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### NY - New York : New York-Northern New Jersey-Long Island
```{r CpiEmpTransportationNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_NY = cu_data_USTransportation %>% 
                                    filter(area_name=="New York-Northern New Jersey-Long Island", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'NY') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USTransportation_NY, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OH - Ohio
- Cleveland-Akron
- Cincinnati-Hamilton

```{r CpiEmpTransportationOH, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_OH = cu_data_USTransportation %>% 
                                    filter( (area_name %in% c("Cleveland-Akron")
                                            & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                            )
                                           |
                                            (area_name %in% c("Cincinnati-Hamilton")
                                             & period %in% c("S01","S02")
                                             )
                                         ) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           area_code = 'A210;A213', 
                                           area_name = 'Cleveland-Akron;Cincinnati-Hamilton',
                                           industry = 'Transportation',
                                           state = 'OH') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USTransportation_OH = merge(EMP_DAT_CAT_SAN_OH, cu_emp_data_USTransportation_OH, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_OH %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon : Portland-Salem
```{r CpiEmpTransportationOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_OR = cu_data_USTransportation %>% 
                                    filter(area_name=="Portland-Salem", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'OR') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USTransportation_OR, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### PA - Pennsylvania
- Philadelphia-Wilmington-Atlantic City
- Pittsburgh

```{r CpiEmpTransportationPA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_PA = cu_data_USTransportation %>% 
                                    filter( (area_name %in% c("Philadelphia-Wilmington-Atlantic City")
                                            & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                            )
                                           |
                                            (area_name %in% c("Pittsburgh")
                                             & period %in% c("S01","S02")
                                             )
                                         ) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           area_code = 'A102;A104', 
                                           area_name = 'Philadelphia-Wilmington-Atlantic City;Pittsburgh',
                                           industry = 'Transportation',
                                           state = 'PA') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USTransportation_PA = merge(EMP_DAT_CAT_SAN_PA, cu_emp_data_USTransportation_PA, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_PA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### TX - Texas
- Dallas-Fort Worth
- Houston-Galveston-Brazoria

```{r CpiEmpTransportationTX, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_TX = cu_data_USTransportation %>% 
                                    filter(area_name %in% c("Dallas-Fort Worth","Houston-Galveston-Brazoria"), 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           area_code = 'A316;A318', 
                                           area_name = 'Dallas-Fort Worth;Houston-Galveston-Brazoria',
                                           industry = 'Transportation',
                                           state = 'TX') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USTransportation_TX = merge(EMP_DAT_CAT_SAN_TX, cu_emp_data_USTransportation_TX, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_TX %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WA - Washington : Seattle-Tacoma-Bremerton
```{r CpiEmpTransportationWA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_WA = cu_data_USTransportation %>% 
                                    filter(area_name=="Seattle-Tacoma-Bremerton", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'WA') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_WA = merge(EMP_DAT_CAT_SAN_WA, cu_emp_data_USTransportation_WA, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_WA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WI - Wisconsin : Milwaukee-Racine
```{r CpiEmpTransportationWI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_WI = cu_data_USTransportation %>% 
                                    filter(area_name=="Milwaukee-Racine", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800,
                                           industry = 'Transportation',
                                           state = 'WI') %>% 
                                    select(c("industry",
                                             "state",
                                             "parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USTransportation_WI = merge(EMP_DAT_CAT_SAN_WI, cu_emp_data_USTransportation_WI, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_WI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Medical

### AK - Alaska : Anchorage
```{r CpiEmpMedicalAK, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_AK = cu_data_USMedical %>% 
                            filter(area_name=="Anchorage", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'AK') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_AK = merge(EMP_DAT_CAT_SAN_AK, cu_emp_data_USMedical_AK, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_AK %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### AZ - Arizona : Phoenix-Mesa
```{r CpiEmpMedicalAZ, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_AZ = cu_data_USMedical %>% 
                            filter(area_name=="Phoenix-Mesa", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'AZ') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_AZ = merge(EMP_DAT_CAT_SAN_AZ, cu_emp_data_USMedical_AZ, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_AZ %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### CA - California
- Los Angeles-Riverside-Orange County
- San Francisco-Oakland-San Jose
- San Diego

```{r CpiEmpMedicalCA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_CA = cu_data_USMedical %>% 
                             filter( (area_name %in% c("Los Angeles-Riverside-Orange County", "San Francisco-Oakland-San Jose")
                                      & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                      )
                                     |
                                      (area_name %in% c("San Diego")
                                       & period %in% c("S01","S02")
                                       )
                                   ) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   area_code = 'A421;A422;A424',
                                   area_name = 'Los Angeles-Riverside-Orange County;San Francisco-Oakland-San Jose;San Diego',
                                   industry = 'Medical',
                                   state = 'CA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value/3),2))

cpi_emp_data_USMedical_CA = merge(EMP_DAT_CAT_SAN_CA, cu_emp_data_USMedical_CA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_CA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### CO - Colorado : Denver-Boulder-Greeley
```{r CpiEmpMedicalCO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_CO = cu_data_USMedical %>% 
                            filter(area_name=="Denver-Boulder-Greeley", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'CO') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_CO = merge(EMP_DAT_CAT_SAN_CO, cu_emp_data_USMedical_CO, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_CO %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### FL - Florida
- Miami-Fort Lauderdale
- Tampa-St. Petersburg-Clearwater

```{r CpiEmpMedicalFL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_FL = cu_data_USMedical %>% 
                            filter( (area_name %in% c("Miami-Fort Lauderdale")
                                    & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                    )
                                   |
                                    (area_name %in% c("Tampa-St. Petersburg-Clearwater")
                                     & period %in% c("S01","S02")
                                     )
                                 ) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   area_code = 'A320;A321',
                                   area_name = 'Miami-Fort Lauderdale;Tampa-St. Petersburg-Clearwater',
                                   industry = 'Medical',
                                   state = 'FL') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_FL = merge(EMP_DAT_CAT_SAN_FL, cu_emp_data_USMedical_FL, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_FL %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### GA - Georgia : Atlanta
```{r CpiEmpMedicalGA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_GA = cu_data_USMedical %>% 
                            filter(area_name=="Atlanta", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'GA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_GA = merge(EMP_DAT_CAT_SAN_GA, cu_emp_data_USMedical_GA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_GA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### HI - Hawaii : Honolulu
```{r CpiEmpMedicalHI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_HI = cu_data_USMedical %>% 
                            filter(area_name=="Honolulu", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'HI') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_HI = merge(EMP_DAT_CAT_SAN_HI, cu_emp_data_USMedical_HI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_HI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### IL - Illinois : Chicago-Gary-Kenosha
```{r CpiEmpMedicalIL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_IL = cu_data_USMedical %>% 
                            filter(area_name=="Chicago-Gary-Kenosha", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'IL') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_IL = merge(EMP_DAT_CAT_SAN_IL, cu_emp_data_USMedical_IL, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_IL %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### KS - Kansas : Kansas City
```{r CpiEmpMedicalKS, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_KS = cu_data_USMedical %>% 
                            filter(area_name=="Kansas City", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'KS') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_KS = merge(EMP_DAT_CAT_SAN_KS, cu_emp_data_USMedical_KS, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_KS %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MA - Massachusetts : Boston-Brockton-Nashua
```{r CpiEmpMedicalMA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_MA = cu_data_USMedical %>% 
                            filter(area_name=="Boston-Brockton-Nashua", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'MA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_MA = merge(EMP_DAT_CAT_SAN_MA, cu_emp_data_USMedical_MA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_MA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan : Detroit-Ann Arbor-Flint
```{r CpiEmpMedicalMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_MI = cu_data_USMedical %>% 
                            filter(area_name=="Detroit-Ann Arbor-Flint", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'MI') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USMedical_MI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MN - Minnesota : Minneapolis-St. Paul
```{r CpiEmpMedicalMN, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_MN = cu_data_USMedical %>% 
                            filter(area_name=="Minneapolis-St. Paul", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'MN') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_MN = merge(EMP_DAT_CAT_SAN_MN, cu_emp_data_USMedical_MN, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_MN %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MO - Missouri : St. Louis
```{r CpiEmpMedicalMO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_MO = cu_data_USMedical %>% 
                            filter(area_name=="St. Louis", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'MO') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_MO = merge(EMP_DAT_CAT_SAN_MO, cu_emp_data_USMedical_MO, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_MO %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### NY - New York
```{r CpiEmpMedicalNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_NY = cu_data_USMedical %>% 
                            filter(area_name=="New York-Northern New Jersey-Long Island", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'NY') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USMedical_NY, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OH - Ohio
- Cleveland-Akron
- Cincinnati-Hamilton

```{r CpiEmpMedicalOH, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_OH = cu_data_USMedical %>% 
                            filter( (area_name %in% c("Cleveland-Akron")
                                    & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                    )
                                   |
                                    (area_name %in% c("Cincinnati-Hamilton")
                                     & period %in% c("S01","S02")
                                     )
                                 ) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   area_code = 'A210;A213', 
                                   area_name = 'Cleveland-Akron;Cincinnati-Hamilton',
                                   industry = 'Medical',
                                   state = 'OH') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USMedical_OH = merge(EMP_DAT_CAT_SAN_OH, cu_emp_data_USMedical_OH, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_OH %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon : Portland-Salem
```{r CpiEmpMedicalOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_OR = cu_data_USMedical %>% 
                            filter(area_name=="Portland-Salem", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'OR') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USMedical_OR, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### PA - Pennsylvania
- Philadelphia-Wilmington-Atlantic City
- Pittsburgh

```{r CpiEmpMedicalPA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_PA = cu_data_USMedical %>% 
                                    filter( (area_name %in% c("Philadelphia-Wilmington-Atlantic City")
                                            & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                            )
                                           |
                                            (area_name %in% c("Pittsburgh")
                                             & period %in% c("S01","S02")
                                             )
                                         ) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   area_code = 'A102;A104', 
                                   area_name = 'Philadelphia-Wilmington-Atlantic City;Pittsburgh',
                                   industry = 'Medical',
                                   state = 'PA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USMedical_PA = merge(EMP_DAT_CAT_SAN_PA, cu_emp_data_USMedical_PA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_PA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### TX - Texas
- Dallas-Fort Worth
- Houston-Galveston-Brazoria

```{r CpiEmpMedicalTX, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_TX = cu_data_USMedical %>% 
                            filter(area_name %in% c("Dallas-Fort Worth","Houston-Galveston-Brazoria"), 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   area_code = 'A316;A318', 
                                   area_name = 'Dallas-Fort Worth;Houston-Galveston-Brazoria',
                                   industry = 'Medical',
                                   state = 'TX') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USMedical_TX = merge(EMP_DAT_CAT_SAN_TX, cu_emp_data_USMedical_TX, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_TX %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WA - Washington : Seattle-Tacoma-Bremerton
```{r CpiEmpMedicalWA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_WA = cu_data_USMedical %>% 
                            filter(area_name=="Seattle-Tacoma-Bremerton", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'WA') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_WA = merge(EMP_DAT_CAT_SAN_WA, cu_emp_data_USMedical_WA, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_WA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WI - Wisconsin : Milwaukee-Racine
```{r CpiEmpMedicalWI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_WI = cu_data_USMedical %>% 
                            filter(area_name=="Milwaukee-Racine", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600,
                                   industry = 'Medical',
                                   state = 'WI') %>% 
                            select(c("industry",
                                     "state",
                                     "parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USMedical_WI = merge(EMP_DAT_CAT_SAN_WI, cu_emp_data_USMedical_WI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_WI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Education & Communication

### AK - Alaska : Anchorage
```{r CpiEmpEduCommAK, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_AK = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Anchorage", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'AK') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_AK = merge(EMP_DAT_CAT_SAN_AK, cu_data_USEducationAndCommunication_AK, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_AK %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### AZ - Arizona : Phoenix-Mesa
```{r CpiEmpEduCommAZ, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_AZ = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Phoenix-Mesa", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'AZ') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_AZ = merge(EMP_DAT_CAT_SAN_AZ, cu_data_USEducationAndCommunication_AZ, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_AZ %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### CA - California
- Los Angeles-Riverside-Orange County
- San Francisco-Oakland-San Jose
- San Diego

```{r CpiEmpEduCommCA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_CA = cu_data_USEducationAndCommunication %>% 
                                          filter( (area_name %in% c("Los Angeles-Riverside-Orange County", "San Francisco-Oakland-San Jose")
                                                    & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                                    )
                                                   |
                                                    (area_name %in% c("San Diego")
                                                     & period %in% c("S01","S02")
                                                     )
                                                 ) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 area_code = 'A421;A422;A424',
                                                 area_name = 'Los Angeles-Riverside-Orange County;San Francisco-Oakland-San Jose;San Diego',
                                                 industry = 'Education & Communication',
                                                 state = 'CA') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value/3),2))

cpi_emp_data_USEducationAndCommunication_CA = merge(EMP_DAT_CAT_SAN_CA, cu_data_USEducationAndCommunication_CA, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_CA %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### CO - Colorado : Denver-Boulder-Greeley
```{r CpiEmpEduCommCO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_CO = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Denver-Boulder-Greeley", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'CO') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_CO = merge(EMP_DAT_CAT_SAN_CO, cu_data_USEducationAndCommunication_CO, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_CO %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### FL - Florida
- Miami-Fort Lauderdale
- Tampa-St. Petersburg-Clearwater

```{r CpiEmpEduCommFL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_FL = cu_data_USEducationAndCommunication %>% 
                                          filter( (area_name %in% c("Miami-Fort Lauderdale")
                                                  & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                                  )
                                                 |
                                                  (area_name %in% c("Tampa-St. Petersburg-Clearwater")
                                                   & period %in% c("S01","S02")
                                                   )
                                               ) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 area_code = 'A320;A321',
                                                 area_name = 'Miami-Fort Lauderdale;Tampa-St. Petersburg-Clearwater',
                                                 industry = 'Education & Communication',
                                                 state = 'FL') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_FL = merge(EMP_DAT_CAT_SAN_FL, cu_data_USEducationAndCommunication_FL, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_FL %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### GA - Georgia : Atlanta
```{r CpiEmpEduCommGA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_GA = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Atlanta", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'GA') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_GA = merge(EMP_DAT_CAT_SAN_GA, cu_data_USEducationAndCommunication_GA, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_GA %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### HI - Hawaii : Honolulu
```{r CpiEmpEduCommHI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_HI = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Honolulu", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'HI') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_HI = merge(EMP_DAT_CAT_SAN_HI, cu_data_USEducationAndCommunication_HI, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_HI %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### IL - Illinois : Chicago-Gary-Kenosha
```{r CpiEmpEduCommIL, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_IL = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Chicago-Gary-Kenosha", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'IL') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_IL = merge(EMP_DAT_CAT_SAN_IL, cu_data_USEducationAndCommunication_IL, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_IL %>%
  ###sample_frac(0.33) %>% 
  DT::datatable()
```

### KS - Kansas : Kansas City
```{r CpiEmpEduCommKS, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_KS = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Kansas City", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'KS') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_KS = merge(EMP_DAT_CAT_SAN_KS, cu_data_USEducationAndCommunication_KS, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_KS %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MA - Massachusetts : Boston-Brockton-Nashua
```{r CpiEmpEduCommMA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_MA = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Boston-Brockton-Nashua", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'MA') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_MA = merge(EMP_DAT_CAT_SAN_MA, cu_data_USEducationAndCommunication_MA, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_MA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan
```{r CpiEmpEduCommMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_MI = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Detroit-Ann Arbor-Flint", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'MI') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_MI = merge(EMP_DAT_CAT_SAN_MI, cu_data_USEducationAndCommunication_MI, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MN - Minnesota : Minneapolis-St. Paul
```{r CpiEmpEduCommMN, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_MN = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Minneapolis-St. Paul", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'MN') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_MN = merge(EMP_DAT_CAT_SAN_MN, cu_data_USEducationAndCommunication_MN, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_MN %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MO - Missouri : St. Louis
```{r CpiEmpEduCommMO, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_MO = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="St. Louis", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'MO') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_MO = merge(EMP_DAT_CAT_SAN_MO, cu_data_USEducationAndCommunication_MO, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_MO %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### NY - New York

```{r CpiEmpEduCommNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_NY = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="New York-Northern New Jersey-Long Island", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'NY') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_NY = merge(EMP_DAT_CAT_SAN_NY, cu_data_USEducationAndCommunication_NY, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OH - Ohio
- Cleveland-Akron
- Cincinnati-Hamilton

```{r CpiEmpEduCommOH, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_OH = cu_data_USEducationAndCommunication %>% 
                                          filter( (area_name %in% c("Cleveland-Akron")
                                                  & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                                  )
                                                 |
                                                  (area_name %in% c("Cincinnati-Hamilton")
                                                   & period %in% c("S01","S02")
                                                   )
                                               ) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 area_code = 'A210;A213', 
                                                 area_name = 'Cleveland-Akron;Cincinnati-Hamilton',
                                                 industry = 'Education & Communication',
                                                 state = 'OH') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USEducationAndCommunication_OH = merge(EMP_DAT_CAT_SAN_OH, cu_data_USEducationAndCommunication_OH, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_OH %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon : Portland-Salem
```{r CpiEmpEduCommOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_OR = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Portland-Salem", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'OR') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_OR = merge(EMP_DAT_CAT_SAN_OR, cu_data_USEducationAndCommunication_OR, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### PA - Pennsylvania
- Philadelphia-Wilmington-Atlantic City
- Pittsburgh

```{r CpiEmpEduCommPA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_PA = cu_data_USEducationAndCommunication %>% 
                                          filter( (area_name %in% c("Philadelphia-Wilmington-Atlantic City")
                                                  & period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")
                                                  )
                                                 |
                                                  (area_name %in% c("Pittsburgh")
                                                   & period %in% c("S01","S02")
                                                   )
                                               ) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 area_code = 'A102;A104', 
                                                 area_name = 'Philadelphia-Wilmington-Atlantic City;Pittsburgh',
                                                 industry = 'Education & Communication',
                                                 state = 'PA') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USEducationAndCommunication_PA = merge(EMP_DAT_CAT_SAN_PA, cu_data_USEducationAndCommunication_PA, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_PA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### TX - Texas
- Dallas-Fort Worth
- Houston-Galveston-Brazoria

```{r CpiEmpEduCommTX, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_TX = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name %in% c("Dallas-Fort Worth","Houston-Galveston-Brazoria"), 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>%
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 area_code = 'A316;A318', 
                                                 area_name = 'Dallas-Fort Worth;Houston-Galveston-Brazoria',
                                                 industry = 'Education & Communication',
                                                 state = 'TX') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value)/2,2))

cpi_emp_data_USEducationAndCommunication_TX = merge(EMP_DAT_CAT_SAN_TX, cu_data_USEducationAndCommunication_TX, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_TX %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WA - Washington : Seattle-Tacoma-Bremerton
```{r CpiEmpEduCommWA, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_WA = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Seattle-Tacoma-Bremerton", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'WA') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_WA = merge(EMP_DAT_CAT_SAN_WA, cu_data_USEducationAndCommunication_WA, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_WA %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### WI - Wisconsin : Milwaukee-Racine
```{r CpiEmpEduCommWI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_WI = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Milwaukee-Racine", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', 
                                                 emp_line_code = 1500,
                                                 industry = 'Education & Communication',
                                                 state = 'WI') %>% 
                                          select(c("industry",
                                                   "state",
                                                   "parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(industry, state, parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = round(sum(value),2))

cpi_emp_data_USEducationAndCommunication_WI = merge(EMP_DAT_CAT_SAN_WI, cu_data_USEducationAndCommunication_WI, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_WI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Combined Employment and CPI Data
```{r CpiEmpCombined, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cpi_emp_data_Combined <- rbind(cpi_emp_data_USFoodBeverage_AK,
                                cpi_emp_data_USFoodBeverage_AZ,
                                cpi_emp_data_USFoodBeverage_CA,
                                cpi_emp_data_USFoodBeverage_CO,
                                cpi_emp_data_USFoodBeverage_FL,
                                cpi_emp_data_USFoodBeverage_GA,
                                cpi_emp_data_USFoodBeverage_HI,
                                cpi_emp_data_USFoodBeverage_IL,
                                cpi_emp_data_USFoodBeverage_KS,
                                cpi_emp_data_USFoodBeverage_MA,
                                cpi_emp_data_USFoodBeverage_MI,
                                cpi_emp_data_USFoodBeverage_MN,
                                cpi_emp_data_USFoodBeverage_MO,
                                cpi_emp_data_USFoodBeverage_NY,
                                cpi_emp_data_USFoodBeverage_OH,
                                cpi_emp_data_USFoodBeverage_OR,
                                cpi_emp_data_USFoodBeverage_PA,
                                cpi_emp_data_USFoodBeverage_TX,
                                cpi_emp_data_USFoodBeverage_WA,
                                cpi_emp_data_USFoodBeverage_WI,
                                cpi_emp_data_USHousing_AK,
                                cpi_emp_data_USHousing_AZ,
                                cpi_emp_data_USHousing_CA,
                                cpi_emp_data_USHousing_CO,
                                cpi_emp_data_USHousing_FL,
                                cpi_emp_data_USHousing_GA,
                                cpi_emp_data_USHousing_HI,
                                cpi_emp_data_USHousing_IL,
                                cpi_emp_data_USHousing_KS,
                                cpi_emp_data_USHousing_MA,
                                cpi_emp_data_USHousing_MI,
                                cpi_emp_data_USHousing_MN,
                                cpi_emp_data_USHousing_MO,
                                cpi_emp_data_USHousing_NY,
                                cpi_emp_data_USHousing_OH,
                                cpi_emp_data_USHousing_OR,
                                cpi_emp_data_USHousing_PA,
                                cpi_emp_data_USHousing_TX,
                                cpi_emp_data_USHousing_WA,
                                cpi_emp_data_USHousing_WI,
                                cpi_emp_data_USTransportation_AK,
                                cpi_emp_data_USTransportation_CA,
                                cpi_emp_data_USTransportation_CO,
                                cpi_emp_data_USTransportation_FL,
                                cpi_emp_data_USTransportation_GA,
                                cpi_emp_data_USTransportation_HI,
                                cpi_emp_data_USTransportation_IL,
                                cpi_emp_data_USTransportation_KS,
                                cpi_emp_data_USTransportation_MA,
                                cpi_emp_data_USTransportation_MI,
                                cpi_emp_data_USTransportation_MN,
                                cpi_emp_data_USTransportation_MO,
                                cpi_emp_data_USTransportation_NY,
                                cpi_emp_data_USTransportation_OH,
                                cpi_emp_data_USTransportation_OR,
                                cpi_emp_data_USTransportation_PA,
                                cpi_emp_data_USTransportation_TX,
                                cpi_emp_data_USTransportation_WA,
                                cpi_emp_data_USTransportation_WI,
                                cpi_emp_data_USMedical_AK,
                                cpi_emp_data_USMedical_AZ,
                                cpi_emp_data_USMedical_CA,
                                cpi_emp_data_USMedical_CO,
                                cpi_emp_data_USMedical_FL,
                                cpi_emp_data_USMedical_GA,
                                cpi_emp_data_USMedical_HI,
                                cpi_emp_data_USMedical_IL,
                                cpi_emp_data_USMedical_KS,
                                cpi_emp_data_USMedical_MA,
                                cpi_emp_data_USMedical_MI,
                                cpi_emp_data_USMedical_MN,
                                cpi_emp_data_USMedical_MO,
                                cpi_emp_data_USMedical_NY,
                                cpi_emp_data_USMedical_OH,
                                cpi_emp_data_USMedical_OR,
                                cpi_emp_data_USMedical_PA,
                                cpi_emp_data_USMedical_TX,
                                cpi_emp_data_USMedical_WA,
                                cpi_emp_data_USMedical_WI,
                                cpi_emp_data_USEducationAndCommunication_AK,
                                cpi_emp_data_USEducationAndCommunication_AZ,
                                cpi_emp_data_USEducationAndCommunication_CA,
                                cpi_emp_data_USEducationAndCommunication_CO,
                                cpi_emp_data_USEducationAndCommunication_FL,
                                cpi_emp_data_USEducationAndCommunication_GA,
                                cpi_emp_data_USEducationAndCommunication_HI,
                                cpi_emp_data_USEducationAndCommunication_IL,
                                cpi_emp_data_USEducationAndCommunication_KS,
                                cpi_emp_data_USEducationAndCommunication_MA,
                                cpi_emp_data_USEducationAndCommunication_MI,
                                cpi_emp_data_USEducationAndCommunication_MN,
                                cpi_emp_data_USEducationAndCommunication_MO,
                                cpi_emp_data_USEducationAndCommunication_NY,
                                cpi_emp_data_USEducationAndCommunication_OH,
                                cpi_emp_data_USEducationAndCommunication_OR,
                                cpi_emp_data_USEducationAndCommunication_PA,
                                cpi_emp_data_USEducationAndCommunication_TX,
                                cpi_emp_data_USEducationAndCommunication_WA,
                                cpi_emp_data_USEducationAndCommunication_WI)
                        
cpi_emp_data_Combined %>%
  sample_frac(0.33) %>% 
  DT::datatable()

write.csv(cpi_emp_data_Combined,'cpi_emp_data_Combined.csv')
```

# Hypothesis Test {.tabset .tabset-fade .tabset-pills}

## T-Test

```{r, include=TRUE, eval=FALSE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
ggplot(cpi_emp_data_Combined) +
  aes(x = paste0(state, '-', industry), y = cpi_value) +
  geom_boxplot() +
  theme_minimal() + 
  theme(axis.text.x=element_text(size=5, angle=90)) + 
  labs(title = "T-Test",
       y = "CPI", 
       x  = "State-Industry", 
       fill = "State", 
       subtitle = "CPI vs State-Industry", 
       caption = "Source: Employment from Select Industry by State")
  coord_flip()

test <- t.test(cpi_emp_data_Combined$"Number of jobs", 
               cpi_emp_data_Combined$cpi_value,
               alternative = "two.sided", 
               var.equal = FALSE)
 
paste("p-value", test$p.value)
 
ggplot(cpi_emp_data_Combined) +
  aes(x = "Number of jobs", y = cpi_value ) +
  geom_boxplot() +
  theme_minimal() + 
  theme(axis.text.x=element_text(size=5, angle=90)) + 
  labs(title = "T-Test",
       y = "CPI", 
       x  = "Number of jobs", 
       fill = "State", 
       subtitle = "Number of jobs vs CPI", 
       caption = "Source: Employment from Select Industry by State")
  coord_flip()

### Partial Least Squares regression model
###anova(model_pls, test = 'Chisq')
```

## ANOVA Tests
```{r, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
### Generlaized Linear regression Model
###anova(model_glm, test = 'Chisq')
```

## Chi-Squared Test
```{r, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
### Linear Regression Model
###anova(lm, test = 'Chisq')
```

# RAJWANT WORK
```{r}
cpi_emp_data_USFoodBeverage_NY %>% 
    select(c("Year","Sector"= "Description","No_Jobs"="Number of jobs","cpi_value")) %>%   
    gather(key="Type", value ="Value", "cpi_value","No_Jobs") %>% 
    ggplot(mapping = aes(x= Year, y=(as.numeric(Value)),fill = Type,group = Type)) + 
    geom_col(position = position_dodge()) + geom_smooth(method = "lm")
    theme(axis.text.x = element_text(angle = 60, colour="gray",hjust = 1,size=rel(0.86))) +
    labs(title = "USSFoodBeverage Data for No. Of Jobs and CPI Value in NY",
         y="Sector", x="Years") 

cpi_emp_data_USFoodBeverage_NY %>% 
    select(c("Year","Sector"= "Description","No_Jobs"="Number of jobs")) %>% 
    ggplot(mapping = aes(x= Year, y=(as.numeric(No_Jobs)))) + 
    geom_col() + 
    theme(axis.text.x = element_text(angle = 60, colour="gray",hjust = 1,size=rel(0.86))) +
    labs(title = "USSFoodBeverage Data for No. Of Jobs  in NY",
         y="Sector", x="Years") 

cpi_emp_data_USFoodBeverage_NY %>% 
    select(c("Year","Sector"= "Description","cpi_value")) %>% 
    ggplot(mapping = aes(x= Year, y=(as.numeric(cpi_value)))) + 
    geom_col() + 
    theme(axis.text.x = element_text(angle = 60, colour="gray",hjust = 1,size=rel(0.86))) +
    labs(title = "USSFoodBeverage Data for CPI Value in NY",
         y = "Sector",x= "Years") 

# summary(as.numeric(cpi_emp_data_USFoodBeverage_NY$`Number of jobs`))
# summary(as.numeric(cpi_emp_data_USFoodBeverage_NY$cpi_value))
# 
# quantile(as.numeric(cpi_emp_data_USFoodBeverage_NY$`Number of jobs`))
# levels(quantile(as.numeric(cpi_emp_data_USFoodBeverage_NY$cpi_value)))
```

## Model
```{r}
#library(DataExplorer)
#library(plot_histogram)
library(lazytrade)

ALL_NY <- rbind(cpi_emp_data_USTransportation_NY,
                cpi_emp_data_USMedical_NY,
                cpi_emp_data_USHousing_NY,
                cpi_emp_data_USFoodBeverage_NY,
                cpi_emp_data_USEducationAndCommunication_NY)

#DataExplorer::plot_missing(ALL_NY, title = "Beverage Training Data: % Missing Values by Data Element")

ALL_NY$`Number of jobs` = as.numeric(ALL_NY$`Number of jobs`)
#plot_histogram(ALL_NY, ggtheme=theme_light())
#plot_correlation(ALL_NY[,c(2,5,9)])

ggplot(ALL_NY[,c("Year","Description","Number of jobs","cpi_value")], 
        mapping=aes(y= log(cpi_value), 
        x=Year,
        color= Description, 
        group = Description)) + geom_smooth() + theme_classic()

ggplot(ALL_NY[,c("Year","Description","Number of jobs","cpi_value")], 
        mapping=aes(y= log(`Number of jobs`), 
        x=Year,
        color= Description, 
        group = Description)) + geom_smooth() + theme_classic()
```

```{r}
ALL_NY

ALL_NY_M <- ALL_NY[,c("Year","Number of jobs","parent_item_code","cpi_value")]
names(ALL_NY_M) = c("Year", "Jobs", "C_Item","CPI")

# ALL_NY_M$Year = as.character(ALL_NY_M$Year)
# ALL_NY_M$E_Area = as.character(ALL_NY_M$E_Area)
library(caret)
set.seed(3456)
trainIndex <- createDataPartition(ALL_NY_M$Jobs, p = .8, 
                                  list = FALSE, 
                                  times = 1)
ALL_NY_train <- ALL_NY_M[ trainIndex,]
ALL_NY_test  <- ALL_NY_M[-trainIndex,]

head(ALL_NY_M)
```

```{r}
metric = 'RMSE'
head(ALL_NY_train )

# Train control
customTrainControl <- trainControl(method = "repeatedcv", 
                                   number = 10 , 
                                   repeats = 5 ,
                                   verboseIter = F)

# Linear Model
lm <- train(Jobs ~ .,
            ALL_NY_train,
            method= 'lm',
            trControl = customTrainControl)
lm$results

summary(lm)
par(mfrow=c(2,2))
plot(lm$finalModel)

#--------------
# https://stackoverflow.com/questions/44200195/how-to-debug-contrasts-can-be-applied-only-to-factors-with-2-or-more-levels-er
ALL_NY_train %>% dplyr::mutate_all(as.factor) %>% str

unique(ALL_NY$area_code)

# multiple LM
lm_cpi_item <- lm(Jobs ~ CPI+C_Item,ALL_NY_train)
summary(lm_cpi_item)

lm_cpi2_item <- lm(Jobs ~ (CPI^2)+C_Item,ALL_NY_train)
summary(lm_cpi2_item)

lm_cpi_year <- lm(Jobs ~ CPI+Year,ALL_NY_train)
summary(lm_cpi_year)

xyplot(ALL_NY_test$Jobs ~ predict(lm),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(ALL_NY_test$Jobs ~ predict(lm_cpi_year),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(resid(lm_cpi_year) ~ predict(lm_cpi_year),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")

#PLS
# Useing train perform  to perfrom  pre-process and tuning together. The function first preprocess the training set by centering it and scaling it. Then the function uses 10-fold cross validation to try the number of components, i.e. latent variables, of the PLS model from 1 to 20.
# # The train function generates a resampling estimate of performance. Because
# the training set size is not small, 10-fold cross-validation should produce
# reasonable estimates of model performance. The function trainControl specifies
# the type of resampling:
ctrl <- trainControl(method = "cv", number = 10)

model_pls<- train(Jobs ~ .,   ALL_NY_train,
                     method = "pls",
                     tuneLength = 20,
                     metric='Rsquared',
                     trControl = ctrl,
                     preProc = c("center", "scale"))
model_pls

model_pls$results[3,2:4]

# M
model_glm<- train(Jobs ~ .,   ALL_NY_train,
                     method = "glm",
                     tuneLength = 20,
                     metric='Rsquared',
                     trControl = ctrl,
                     preProc = c("center", "scale"))
model_glm
```

```{r , include=TRUE, eval=FALSE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
test_model(test_dataset = model_pls,
           predictor_dataset = ALL_NY_train,
           test_type = "regression")

# TEST MODEL with Train  data
xyplot(ALL_NY_train$Jobs ~ predict(model_pls),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(ALL_NY_train$Jobs ~ predict(lm),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(ALL_NY_train$Jobs ~ predict(lm_cpi2_item),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(ALL_NY_train$Jobs ~ predict(lm_cpi_item),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(ALL_NY_train$Jobs ~ predict(model_glm),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

# TEST MODEL with TEst data
xyplot(ALL_NY_test$Jobs ~ predict(model_pls,ALL_NY_test),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(ALL_NY_test$Jobs ~ predict(lm,ALL_NY_test),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

xyplot(ALL_NY_test$Jobs ~ predict(lm_cpi_item,ALL_NY_test),
 ## plot the points (type = 'p') and a background grid ('g')
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Observed")

# REssidual Plot with train data
xyplot(resid(model_pls) ~ predict(model_pls),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")
 
xyplot(resid(lm) ~ predict(lm),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")

xyplot(resid(lm_cpi_item) ~ predict(lm_cpi_item),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")
    
xyplot(resid(lm_cpi2_item) ~ predict(lm_cpi2_item),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")

xyplot(resid(lm_cpi2_item) ~ predict(lm_cpi2_item),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")
      
# REssidual Plot with Test data
xyplot(resid(model_pls) ~ predict(model_pls,ALL_NY_test),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")
 
xyplot(resid(model_glm) ~ predict(model_glm,ALL_NY_test),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")
  
xyplot(resid(lm_cpi_item) ~ predict(lm_cpi_item,ALL_NY_test),
 type = c("p", "g"),
 xlab = "Predicted", ylab = "Residuals")
    
data.frame("LM Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm, ALL_NY_test))),
           "MAPE" =  MLmetrics::MAPE(predict(lm, ALL_NY_test),ALL_NY_test$Jobs))
data.frame("lm_cpi2_item Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm_cpi2_item, ALL_NY_test))),
           "MAPE" =  MLmetrics::MAPE(predict(lm_cpi2_item, ALL_NY_test),ALL_NY_test$Jobs))
data.frame("lm_cpi_item Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm_cpi_item, ALL_NY_test))),
           "MAPE" =  MLmetrics::MAPE(predict(lm_cpi2_item, ALL_NY_test),ALL_NY_test$Jobs))
data.frame("lm_cpi_year Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm_cpi_year, ALL_NY_test))),
           "MAPE" =  MLmetrics::MAPE(predict(lm_cpi_year, ALL_NY_test),ALL_NY_test$Jobs))
data.frame("PLS Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(model_pls, ALL_NY_test))),
           "MAPE" =  MLmetrics::MAPE(predict(model_pls, ALL_NY_test),ALL_NY_test$Jobs))

cbind(data.frame("LM Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm, ALL_NY_test))),
                 "MAPE" =  MLmetrics::MAPE(predict(lm, ALL_NY_test),ALL_NY_test$Jobs)),
      data.frame("lm_cpi2_item Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm_cpi2_item, ALL_NY_test))),
                 "MAPE" =  MLmetrics::MAPE(predict(lm_cpi2_item, ALL_NY_test),ALL_NY_test$Jobs)),
      data.frame("lm_cpi_item Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm_cpi_item, ALL_NY_test))),
                 "MAPE" =  MLmetrics::MAPE(predict(lm_cpi2_item, ALL_NY_test),ALL_NY_test$Jobs)),
      data.frame("lm_cpi_year Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(lm_cpi_year, ALL_NY_test))),
                 "MAPE" =  MLmetrics::MAPE(predict(lm_cpi_year, ALL_NY_test),ALL_NY_test$Jobs)),
      data.frame("PLS Model"= defaultSummary(data.frame(obs=ALL_NY_test$Jobs,pred=predict(model_pls, ALL_NY_test))),
                 "MAPE" =  MLmetrics::MAPE(predict(model_pls, ALL_NY_test),ALL_NY_test$Jobs))
    )
```

# References
- [How to import multiple .csv files at once?](https://stackoverflow.com/questions/11433432/how-to-import-multiple-csv-files-at-once)
- [How to debug "contrasts can be applied only to factors with 2 or more levels" error?](https://stackoverflow.com/questions/44200195/how-to-debug-contrasts-can-be-applied-only-to-factors-with-2-or-more-levels-er)