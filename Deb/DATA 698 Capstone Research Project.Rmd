---
title: 'DATA 698 : Capstone Research Project'
subtitle: Capstone Project on CPI and Employment
author: "Debabrata Kabiraj, Joseph Simone and Rajwant Mishra"
date: "Oct 1, 2020"
output: 
  rmdformats::readthedown:
    number_sections: true # if you want number sections at each table header
    smooth_scroll: true
    theme: united # many options for theme, this one is my favorite.
    highlight: tango # specifies the syntax highlighting style
   #toc: true # table of content true
    toc_collapsed : true
    toc_float: true
    toc_depth: 5
    code_folding: hide
    df_print: paged
---

# Overview

We are in totally different era of twenty first century, and it gives us very rare situation where any positive news would help the humankind. We want to use the historical CPI data and find the relation of it with the employment, in hope that we would have some positive news on employment by following the trend of the data in past.  

We feel that lower CPI would result in more job opportunity, as the it gives space for more competition in small business across sectors.   
 
# Capstone Project on CPI and Employment

## Data Preparation

Load the required libraries

```{r message=FALSE, warning=FALSE}
#packages <- c("R.rsp","pandocfilters","knitr","plyr","tidyr","dplyr","ggplot2","plotly","sqldf","MASS","reshape2","Amelia","mice","googleVis","stringi","ROCR","scatterplot3d","visdat","gridExtra","sjmisc")
#install.packages (packages, repos="http://cran.us.r-project.org", dependencies=TRUE, lib="C:/Program Files/R/R-3.6.3/library")
#invisible (lapply (packages, library, character.only = T))
#install.packages("devtools", lib="C:/Program Files/R/R-3.6.3/library")
#devtools::install_github("hadley/ggplot2")

library(tidyverse)
library(kableExtra)
library(lubridate)
library(forecast)
library(stringi)
library(dplyr)
```

### Load required Datasets

```{r load-files, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}
file_path <- "../data/cpi/industry/clean/"

read_plus <- function(flnm) {
    read_csv(flnm) %>% 
        mutate(filename = gsub('.{6}$', '', # remove the last 4 characters from filename (_clean)
                               (sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                                    basename(flnm) # get filename without the directory file path
                                    )
                                )
                               )
               )
}

tbl_with_sources <- list.files(path = file_path,
                               pattern = "*.csv", 
                               full.names = T) %>% 
                      map_df(~read_plus(.))
```

```{r show-raw-data, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
DT::datatable(tbl_with_sources)

print(unique(tbl_with_sources$filename))
```

```{r loadFiles, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
file_path <- "../data/cpi/archive/"

## Read files named *.csv
filenames <- list.files(path=file_path,
                        pattern="*.csv",
                        full.names = TRUE)
#print(filenames)

##Create list of data frame names without the ".csv" part 
names <- gsub(pattern='\\.', 
              replacement='_', # remove the last 4 characters from filename (_clean)
              x=(sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                    basename(filenames) # get filename without the directory file path
                   )
                 )
              )
#print(names)

###Load all files
for(i in filenames){
  ## Create list of data frame names without the ".csv" part 
  name <- gsub(pattern='\\.', 
               replacement='_', # remove the last 4 characters from filename (_clean)
               x=(sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                      basename(i) # get filename without the directory file path
                     )
                 )
              )
   print(name)
   assign(x=name, value=data.frame(read.csv(i)))
   #DT::datatable(name)
}
```

### Reference Data

```{r fix_source, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
tbl_with_sources <- tbl_with_sources %>%
                      mutate(industry = case_when(
                                                  stri_detect_fixed(filename, "mfg") ~ "Manufacturing",
                                                  stri_detect_fixed(filename, "manufacturing") ~ "Manufacturing",
                                                  stri_detect_fixed(filename, "electric_power_distribution") ~ "Utilities",
                                                  stri_detect_fixed(filename, "transportation") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "general_freight") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "railroads") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "car_dealers") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "transport") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "medical") ~ "Health care and social assistance",
                                                  stri_detect_fixed(filename, "health") ~ "Health care and social assistance",
                                                  stri_detect_fixed(filename, "drugs") ~ "Health care and social assistance",
                                                  stri_detect_fixed(filename, "grocery_stores") ~ "Retail trade",
                                                  stri_detect_fixed(filename, "grocery_and_related_products") ~ "Wholesale trade",
                                                  TRUE ~ ""
                                                  )
                             )
DT::datatable(tbl_with_sources)
```

#### Area
```{r show_area, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_area)
```

#### Base
```{r show_base, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_base)
```

#### Item
```{r show_item, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_item)
```

#### Periodicity
```{r show_periodicity, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_periodicity)
```

#### Series
```{r show_series, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_series)
```

#### Period
```{r show_period, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_period)
```

```{r show_unique_items, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
#print(unique(cu_series$series_title))
print(unique(cu_item$item_name))
```

### Combined Reference Data
```{r show_references, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_reference_data = cu_series %>% 
                    inner_join(cu_area, by="area_code") %>% 
                    inner_join(cu_item, by="item_code") %>% 
                    inner_join(cu_periodicity, by="periodicity_code") %>% 
                    inner_join(cu_base, by="base_code")

colnames(cu_reference_data)[which(names(cu_reference_data) == "display_level.x")] <- "area_display_level"
colnames(cu_reference_data)[which(names(cu_reference_data) == "selectable.x")] <- "area_selectable"
colnames(cu_reference_data)[which(names(cu_reference_data) == "sort_sequence.x")] <- "area_sort_sequence"
colnames(cu_reference_data)[which(names(cu_reference_data) == "display_level.y")] <- "item_display_level"
colnames(cu_reference_data)[which(names(cu_reference_data) == "selectable.y")] <- "item_selectable"
colnames(cu_reference_data)[which(names(cu_reference_data) == "sort_sequence.y")] <- "item_sort_sequence"

cu_reference_data <- cu_reference_data[c("series_id",
                                         "area_code",
                                         "area_name",
                                         "area_display_level",
                                         "area_selectable",
                                         "area_sort_sequence",
                                         "item_code",
                                         "item_name",
                                         "item_display_level",
                                         "item_selectable",
                                         "item_sort_sequence",
                                         "seasonal",
                                         "periodicity_code",
                                         "periodicity_name",
                                         "base_code",
                                         "base_name",
                                         "base_period",
                                         "series_title",
                                         "footnote_codes",
                                         "begin_year",
                                         "begin_period",
                                         "end_year",
                                         "end_period")]

DT::datatable(cu_reference_data)
```

## Data Exploration

### CPI - US Food Beverages
```{r USFoodBeverage, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_data_11_USFoodBeverage = cu_data_11_USFoodBeverage %>% 
                              inner_join(cu_reference_data, by="series_id") %>% 
                              inner_join(cu_period, by="period")
DT::datatable(head(cu_data_11_USFoodBeverage))
```

### CPI - US Housing
```{r USHousing, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_data_12_USHousing = cu_data_12_USHousing %>% 
                        inner_join(cu_reference_data, by="series_id") %>% 
                        inner_join(cu_period, by="period")
DT::datatable(head(cu_data_12_USHousing))
```

### CPI - US Transportation
```{r USTransportation, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_data_14_USTransportation = cu_data_14_USTransportation %>% 
                               inner_join(cu_reference_data, by="series_id") %>% 
                               inner_join(cu_period, by="period")
DT::datatable(head(cu_data_14_USTransportation))
```

### CPI - US Medical
```{r USMedical, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_data_15_USMedical = cu_data_15_USMedical %>% 
                        inner_join(cu_reference_data, by="series_id") %>% 
                        inner_join(cu_period, by="period")
DT::datatable(head(cu_data_15_USMedical))
```

### CPI - US Education And Communication
```{r USEducationAndCommunication, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_data_17_USEducationAndCommunication = cu_data_17_USEducationAndCommunication %>% 
                                          inner_join(cu_reference_data, by="series_id") %>% 
                                          inner_join(cu_period, by="period")
DT::datatable(head(cu_data_17_USEducationAndCommunication))
```

### References

- [How to import multiple .csv files at once?](https://stackoverflow.com/questions/11433432/how-to-import-multiple-csv-files-at-once)
