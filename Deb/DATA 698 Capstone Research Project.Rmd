---
title: 'DATA 698 : Capstone Research Project'
subtitle: Capstone Project on CPI and Employment
author: "Debabrata Kabiraj, Joseph Simone and Rajwant Mishra"
date: "Oct 1, 2020"
output: 
  rmdformats::readthedown:
    number_sections: true # if you want number sections at each table header
    smooth_scroll: true
    theme: united # many options for theme, this one is my favorite.
    highlight: tango # specifies the syntax highlighting style
   #toc: true # table of content true
    toc_collapsed : true
    toc_float: true
    toc_depth: 5
    code_folding: hide
    df_print: paged
---

# Overview

We are in totally different era of twenty first century, and it gives us very rare situation where any positive news would help the humankind. We want to use the historical CPI data and find the relation of it with the employment, in hope that we would have some positive news on employment by following the trend of the data in past.  

We feel that lower CPI would result in more job opportunity, as the it gives space for more competition in small business across sectors.   
 
# Capstone Project on CPI and Employment

1. The estimates of employment for 1998-2006 are based on the 2002 North American Industry Classification System (NAICS). The estimates for 2007-2010 are based on the 2007 NAICS. The estimates for 2011-2016 are based on the 2012 NAICS. The estimates for 2017 forward are based on the 2017 NAICS.
2. Excludes limited partners.
3. Under the 2007 NAICS, internet publishing and broadcasting was reclassified to other information services.

- (NA) Not available.
- (NM) Not meaningful.
- (D) Not shown to avoid disclosure of confidential information; estimates are included in higher-level totals.
- (T) Estimate for employment suppressed to cover corresponding estimate for earnings. Estimates for this item are included in the total.

Last updated: September 24, 2019- new statistics for 2018; revised statistics for 2014-2017.

# Data Preparation

Load the required libraries

```{r message=FALSE, warning=FALSE}
#packages <- c("R.rsp","pandocfilters","knitr","plyr","tidyr","dplyr","ggplot2","plotly","sqldf","MASS","reshape2","Amelia","mice","googleVis","stringi","ROCR","scatterplot3d","visdat","gridExtra","sjmisc")
#install.packages (packages, repos="http://cran.us.r-project.org", dependencies=TRUE, lib="C:/Program Files/R/R-3.6.3/library")
#invisible (lapply (packages, library, character.only = T))
#install.packages("devtools", lib="C:/Program Files/R/R-3.6.3/library")
#devtools::install_github("hadley/ggplot2")

library(tidyverse)
library(kableExtra)
library(lubridate)
library(forecast)
library(stringi)
library(dplyr)
```

## Load Employment Datasets

```{r load-sainc-files, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
file_path <- "../data/cpi/SAINC/"

EMP_DATA_FILE <- paste0(file_path,"EMP9818.csv")
EMP_DATA <- read_delim(EMP_DATA_FILE, delim = ",", col_names = TRUE, trim_ws= TRUE) 
#,skip = 6,col_types = list(col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character(),col_character()))
# names(SAP_INV_DAT) = c("DROP","I_BILLDATE","I_ORG","I_DC","I_DOCCA","I_BILLTYPE","I_ORDER_REA","I_DIV","I_MATYPE","I_BILL_QTY","BLANK")
# SAP_INV_DAT<- SAP_INV_DAT[-which(is.na(SAP_INV_DAT$I_ORG)),] %>% .[-str_which(trimws(.$I_ORG),'SOrg.|-----'),c(-1,-11)]
# 3
# SAP_INV_DAT$I_BILLDATE <- date(parse_datetime(SAP_INV_DAT$I_BILLDATE, "%m/%d/%Y"))
# 
# head(SAP_INV_DAT)
summary(EMP_DATA)
DT::datatable(EMP_DATA)

# Reading the Category and detail Desc for ref.
EMP_DEF_FILE <- paste0(file_path,"SAEMP25N__definition.xml")
IND_DESC <- XML::xmlToDataFrame(EMP_DEF_FILE)
names(IND_DESC) <- c("LineCode","Description")
glimpse(IND_DESC)
head(IND_DESC,5)
```

## Show Relevant Employment Data

```{r emp-data, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
# MN-MAIN  | NN - RANGE  | NL - LAST |
EMAP_CAT_LAST <- EMP_DATA[,c(2,5,6,7)] %>% 
                  filter(GeoName=="United States") %>% 
                  mutate(ISM = ifelse(IndustryClassification=="...","M","N")) %>% 
                  separate(IndustryClassification, c("From", "To"))  %>% 
                  mutate(ISML = ifelse(is.na(To)==T,"L","N")) %>% 
                  filter(ISML %in% c("L","N")) %>%  
                  select(.,LineCode,Description)
#DT::datatable(EMAP_CAT_LAST)

EMP_DAT_CAT <- EMP_DATA[,c(2,5,9:29)] %>% 
                left_join(EMAP_CAT_LAST,.,by="LineCode")
glimpse(EMP_DAT_CAT)
head(EMP_DAT_CAT,130)
#DT::datatable(EMP_DAT_CAT)

temp_name <- names(EMP_DAT_CAT [,c(4:24)])
EMP_DAT_CAT_SAN <-  data.frame(lapply(EMP_DAT_CAT [,c(4:24)],function(x) {
                      gsub("(D)|(T)",NA,x)
                    })) 
names(EMP_DAT_CAT_SAN) = temp_name
#DT::datatable(EMP_DAT_CAT_SAN)

EMP_DAT_CAT_SAN <- cbind(EMP_DAT_CAT[,c(1:3)],EMP_DAT_CAT_SAN)
#DT::datatable(EMP_DAT_CAT_SAN)
```

### Employment from Select Industry by Area

#### NY - New York

```{r emp-data-ny, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_NY <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="New York") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_NY %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### MI - Michigan

```{r emp-data-mi, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_MI <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Michigan") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_MI %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

#### OR - Oregon

```{r emp-data-or, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EMP_DAT_CAT_SAN_OR <- EMP_DAT_CAT_SAN %>% 
                        filter(LineCode %in% c(705,1100,800,1600,1500)) %>% 
                        filter(GeoName=="Oregon") %>% 
                        reshape2::melt(
                          id.vars = c("LineCode","Description","GeoName"), 
                          variable.name = "Year", 
                          value.name = "Number of jobs")

EMP_DAT_CAT_SAN_OR %>%
  #sample_frac(0.33) %>% 
  DT::datatable()
```

## Load CPI Data

```{r load-cpi-files, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}
file_path <- "../data/cpi/industry/clean/"

read_plus <- function(flnm) {
    read_csv(flnm) %>% 
        mutate(filename = gsub('.{6}$', '', # remove the last 4 characters from filename (_clean)
                               (sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                                    basename(flnm) # get filename without the directory file path
                                    )
                                )
                               )
               )
}
tbl_with_sources <- list.files(path = file_path,
                               pattern = "*.csv", 
                               full.names = T) %>% 
                      map_df(~read_plus(.))
DT::datatable(tbl_with_sources)
print(unique(tbl_with_sources$filename))
```

```{r load-cu-files, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
file_path <- "../data/cpi/archive/"

## Read files named *.csv
filenames <- list.files(path=file_path,
                        pattern="*.csv",
                        full.names = TRUE)
#print(filenames)

##Create list of data frame names without the ".csv" part 
names <- gsub(pattern='\\.', 
              replacement='_', # remove the last 4 characters from filename (_clean)
              x=(sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                    basename(filenames) # get filename without the directory file path
                   )
                 )
              )
#print(names)

###Load all files
for(i in filenames){
  ## Create list of data frame names without the ".csv" part 
  name <- gsub(pattern='\\.', 
               replacement='_', # remove the last 4 characters from filename (_clean)
               x=(sub(pattern = "(.*)\\..*$", replacement = "\\1", # remove extenson from filename (.csv)
                      basename(i) # get filename without the directory file path
                     )
                 )
              )
   print(name)
   assign(x=name, value=data.frame(read.csv(i)))
   #DT::datatable(name)
}
```

## Show CPI Reference Data

```{r fix_source, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
tbl_with_sources <- tbl_with_sources %>%
                      mutate(industry = case_when(
                                                  stri_detect_fixed(filename, "mfg") ~ "Manufacturing",
                                                  stri_detect_fixed(filename, "manufacturing") ~ "Manufacturing",
                                                  stri_detect_fixed(filename, "electric_power_distribution") ~ "Utilities",
                                                  stri_detect_fixed(filename, "transportation") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "general_freight") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "railroads") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "car_dealers") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "transport") ~ "Transportation and warehousing",
                                                  stri_detect_fixed(filename, "medical") ~ "Health care and social assistance",
                                                  stri_detect_fixed(filename, "health") ~ "Health care and social assistance",
                                                  stri_detect_fixed(filename, "drugs") ~ "Health care and social assistance",
                                                  stri_detect_fixed(filename, "grocery_stores") ~ "Retail trade",
                                                  stri_detect_fixed(filename, "grocery_and_related_products") ~ "Wholesale trade",
                                                  TRUE ~ ""
                                                  )
                             )
DT::datatable(tbl_with_sources)
```

### Area
```{r show_area, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_area)
```

### Base
```{r show_base, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_base)
```

### Item
```{r show_item, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_item)
```

### Periodicity
```{r show_periodicity, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_periodicity)
```

### Series
```{r show_series, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_series)
```

### Period
```{r show_period, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
DT::datatable(cu_period)
```

## Combined Reference Data
```{r show_references, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=FALSE, results='show'}
cu_reference_data = cu_series %>% 
                    inner_join(cu_area, by="area_code") %>% 
                    inner_join(cu_item, by="item_code") %>% 
                    inner_join(cu_periodicity, by="periodicity_code") %>% 
                    inner_join(cu_base, by="base_code")

colnames(cu_reference_data)[which(names(cu_reference_data) == "display_level.x")] <- "area_display_level"
colnames(cu_reference_data)[which(names(cu_reference_data) == "selectable.x")] <- "area_selectable"
colnames(cu_reference_data)[which(names(cu_reference_data) == "sort_sequence.x")] <- "area_sort_sequence"
colnames(cu_reference_data)[which(names(cu_reference_data) == "display_level.y")] <- "item_display_level"
colnames(cu_reference_data)[which(names(cu_reference_data) == "selectable.y")] <- "item_selectable"
colnames(cu_reference_data)[which(names(cu_reference_data) == "sort_sequence.y")] <- "item_sort_sequence"

cu_reference_data <- cu_reference_data[c("series_id",
                                         "series_title",
                                         "area_code",
                                         "area_name",
                                         "area_display_level",
                                         "area_selectable",
                                         "area_sort_sequence",
                                         "item_code",
                                         "item_name",
                                         "item_display_level",
                                         "item_selectable",
                                         "item_sort_sequence",
                                         "seasonal",
                                         "periodicity_code",
                                         "periodicity_name",
                                         "base_code",
                                         "base_name",
                                         "base_period")]
DT::datatable(cu_reference_data)
```

## Show CPI Data from Select Industry

### CPI - US Food Beverages
```{r USFoodBeverage, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
FoodItemCode <- cu_reference_data %>%
                    filter(grepl('SAF|SEF|SS0|SS1|SS20', item_code))
                    #dplyr::filter(item_code %like% 'SAH' | item_code %like% 'SEH')
#DT::datatable((FoodItemCode))

cu_data_USFoodBeverage = cu_data_0_Current %>% 
                              inner_join(FoodItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USFoodBeverage))
```

### CPI - US Housing
```{r USHousing, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
HousingItemCode <- cu_reference_data %>%
                    #filter(grepl('SAH|SEH', item_code, fixed = TRUE))
                    filter(grepl('SAH|SEH', item_code))
                    #dplyr::filter(item_code %like% 'SAH' | item_code %like% 'SEH')
#DT::datatable((HousingItemCode))

cu_data_USHousing = cu_data_0_Current %>% 
                              inner_join(HousingItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               #filter(item_code %like% c('SAH','SEH')) %>%
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USHousing))
```

### CPI - US Transportation
```{r USTransportation, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
TransportItemCode <- cu_reference_data %>%
                    filter(grepl('SAT|SET|SS4|SS52|SS53|SAS24|SAS4', item_code))
                    #dplyr::filter(item_code %like% 'SAH' | item_code %like% 'SEH')
#DT::datatable((TransportItemCode))

cu_data_USTransportation = cu_data_0_Current %>% 
                              inner_join(TransportItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USTransportation))
```

### CPI - US Medical
```{r USMedical, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
MedicalItemCode <- cu_reference_data %>%
                    filter(grepl('SAM|SEM|SS57', item_code))
                    #dplyr::filter(item_code %like% 'SAH' | item_code %like% 'SEH')
#DT::datatable((MedicalItemCode))

cu_data_USMedical = cu_data_0_Current %>% 
                              inner_join(MedicalItemCode, by="series_id") %>% 
                              inner_join(cu_period, by="period") %>% 
                               filter(year %in% (1998:2018)) %>% 
                               select(c("series_id",
                                        "series_title",
                                        "year",
                                        "period",
                                        "period_abbr",
                                        "period_name",
                                        "value",
                                        "area_code",
                                        "area_name",
                                        "area_display_level",
                                        "area_selectable",
                                        "area_sort_sequence",
                                        "item_code",
                                        "item_name",
                                        "item_display_level",
                                        "item_selectable",
                                        "item_sort_sequence",
                                        "seasonal",
                                        "periodicity_code",
                                        "periodicity_name",
                                        "base_code",
                                        "base_name",
                                        "base_period"))
DT::datatable(head(cu_data_USMedical))
```

### CPI - US Education And Communication
```{r USEducationAndCommunication, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
EducationItemCode <- cu_reference_data %>%
                    filter(grepl('SAE|SEE|SSE|SS27', item_code))
                    #dplyr::filter(item_code %like% 'SAH' | item_code %like% 'SEH')
#DT::datatable((EducationItemCode))

cu_data_USEducationAndCommunication = cu_data_0_Current %>% 
                                        inner_join(EducationItemCode, by="series_id") %>% 
                                        inner_join(cu_period, by="period") %>% 
                                         filter(year %in% (1998:2018)) %>% 
                                         select(c("series_id",
                                                  "series_title",
                                                  "year",
                                                  "period",
                                                  "period_abbr",
                                                  "period_name",
                                                  "value",
                                                  "area_code",
                                                  "area_name",
                                                  "area_display_level",
                                                  "area_selectable",
                                                  "area_sort_sequence",
                                                  "item_code",
                                                  "item_name",
                                                  "item_display_level",
                                                  "item_selectable",
                                                  "item_sort_sequence",
                                                  "seasonal",
                                                  "periodicity_code",
                                                  "periodicity_name",
                                                  "base_code",
                                                  "base_name",
                                                  "base_period"))
DT::datatable(head(cu_data_USEducationAndCommunication))
```
```{r 17USEducationAndCommunication, include=FALSE, eval=FALSE, message=FALSE, warning=FALSE, echo=FALSE, results='hide'}
cu_data_17_USEducationAndCommunication = cu_data_17_USEducationAndCommunication %>% 
                                          inner_join(cu_reference_data, by="series_id") %>% 
                                          inner_join(cu_period, by="period") %>% 
                                           filter(year %in% (1998:2018)) %>% 
                                           select(c("series_id",
                                                    "series_title",
                                                    "year",
                                                    "period",
                                                    "period_abbr",
                                                    "period_name",
                                                    "value",
                                                    "area_code",
                                                    "area_name",
                                                    "area_display_level",
                                                    "area_selectable",
                                                    "area_sort_sequence",
                                                    "item_code",
                                                    "item_name",
                                                    "item_display_level",
                                                    "item_selectable",
                                                    "item_sort_sequence",
                                                    "seasonal",
                                                    "periodicity_code",
                                                    "periodicity_name",
                                                    "base_code",
                                                    "base_name",
                                                    "base_period"))
DT::datatable((cu_data_17_USEducationAndCommunication))
```

# Employment vs CPI - by Industry and Area

## Food & Beverages

### NY - New York

```{r CpiEmpFoodBeverageNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_NY = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="New York-Northern New Jersey-Long Island", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705) %>% 
                                   select(c("parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = sum(value))
#cu_emp_data_USFoodBeverage_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Food and beverage stores
#EMP_DAT_CAT_SAN_USFoodBeverage_NY = EMP_DAT_CAT_SAN_NY %>%
#                                      filter(LineCode==705)%>%
#                                      mutate(parent_line_code = 705)

cpi_emp_data_USFoodBeverage_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USFoodBeverage_NY, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan

```{r CpiEmpFoodBeverageMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_MI = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Detroit-Ann Arbor-Flint", 
                                         period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705) %>% 
                                   select(c("parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = sum(value))
#cu_emp_data_USFoodBeverage_MI %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Food and beverage stores
#EMP_DAT_CAT_SAN_USFoodBeverage_MI = EMP_DAT_CAT_SAN_NY %>%
#                                      filter(LineCode==705)%>%
#                                      mutate(parent_line_code = 705)

cpi_emp_data_USFoodBeverage_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USFoodBeverage_MI, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon

```{r CpiEmpFoodBeverageOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USFoodBeverage_OR = cu_data_USFoodBeverage %>% 
                                  filter(area_name=="Portland-Salem", 
                                         period %in% c("S01","S02")) %>% 
                                  mutate(parent_item_code = 'SAF', 
                                         emp_line_code = 705) %>% 
                                   select(c("parent_item_code",
                                            "emp_line_code",
                                            "series_id",
                                            "series_title",
                                            "year",
                                            "period",
                                            "period_abbr",
                                            "period_name",
                                            "value",
                                            "area_code",
                                            "area_name",
                                            "area_display_level",
                                            "area_selectable",
                                            "area_sort_sequence",
                                            "item_code",
                                            "item_name",
                                            "item_display_level",
                                            "item_selectable",
                                            "item_sort_sequence",
                                            "seasonal",
                                            "periodicity_code",
                                            "periodicity_name",
                                            "base_code",
                                            "base_name",
                                            "base_period")) %>% 
                                  group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                  summarise(cpi_value = sum(value))

#cu_emp_data_USFoodBeverage_MI %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Food and beverage stores
#EMP_DAT_CAT_SAN_USFoodBeverage_MI = EMP_DAT_CAT_SAN_NY %>%
#                                      filter(LineCode==705)%>%
#                                      mutate(parent_line_code = 705)

cpi_emp_data_USFoodBeverage_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USFoodBeverage_OR, 
                                       by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USFoodBeverage_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Housing

### NY - New York

```{r CpiEmpHousingNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_NY = cu_data_USHousing  %>% 
                            filter(area_name=="New York-Northern New Jersey-Long Island", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100) %>% 
                            select(c("parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = sum(value))
#cu_emp_data_USHousing_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Real estate and rental and leasing
#EMP_DAT_CAT_SAN_USHousing_NY = EMP_DAT_CAT_SAN_NY %>%
#                                  filter(LineCode %in% c(1100,1101,1102,1103)) %>%
#                                  mutate(parent_line_code = 1100)

cpi_emp_data_USHousing_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USHousing_NY, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan

```{r CpiEmpHousingMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_MI = cu_data_USHousing  %>% 
                            filter(area_name=="Detroit-Ann Arbor-Flint", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100) %>% 
                            select(c("parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = sum(value))
#cu_emp_data_USHousing_MI %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Real estate and rental and leasing
#EMP_DAT_CAT_SAN_USHousing_MI = EMP_DAT_CAT_SAN_MI %>%
#                                  filter(LineCode %in% c(1100,1101,1102,1103)) %>%
#                                  mutate(parent_line_code = 1100)

cpi_emp_data_USHousing_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USHousing_MI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon

```{r CpiEmpHousingOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USHousing_OR = cu_data_USHousing  %>% 
                            filter(area_name=="Portland-Salem", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAH', 
                                   emp_line_code = 1100) %>% 
                            select(c("parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = sum(value))
#cu_emp_data_USHousing_MI %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Real estate and rental and leasing
#EMP_DAT_CAT_SAN_USHousing_MI = EMP_DAT_CAT_SAN_MI %>%
#                                  filter(LineCode %in% c(1100,1101,1102,1103)) %>%
#                                  mutate(parent_line_code = 1100)

cpi_emp_data_USHousing_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USHousing_OR, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USHousing_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Transportation

### NY - New York

```{r CpiEmpTransportationNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_NY = cu_data_USTransportation %>% 
                                    filter(area_name=="New York-Northern New Jersey-Long Island", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800) %>% 
                                    select(c("parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = sum(value))
#cu_emp_data_USTransportation_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Transportation and warehousing
#EMP_DAT_CAT_SAN_USTransportation_NY = EMP_DAT_CAT_SAN_NY %>%
#                                        filter(LineCode %in% c(800,801,802,803,804,805,806,807,808,809,811)) %>%
#                                        mutate(parent_line_code = 800)

cpi_emp_data_USTransportation_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USTransportation_NY, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan

```{r CpiEmpTransportationMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_MI = cu_data_USTransportation %>% 
                                    filter(area_name=="Detroit-Ann Arbor-Flint", 
                                           period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800) %>% 
                                    select(c("parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = sum(value))
#cu_emp_data_USTransportation_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Transportation and warehousing
#EMP_DAT_CAT_SAN_USTransportation_NY = EMP_DAT_CAT_SAN_NY %>%
#                                        filter(LineCode %in% c(800,801,802,803,804,805,806,807,808,809,811)) %>%
#                                        mutate(parent_line_code = 800)

cpi_emp_data_USTransportation_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USTransportation_MI, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon

```{r CpiEmpTransportationOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USTransportation_OR = cu_data_USTransportation %>% 
                                    filter(area_name=="Portland-Salem", 
                                           period %in% c("S01","S02")) %>% 
                                    mutate(parent_item_code = 'SAT', 
                                           emp_line_code = 800) %>% 
                                    select(c("parent_item_code",
                                             "emp_line_code",
                                             "series_id",
                                             "series_title",
                                             "year",
                                             "period",
                                             "period_abbr",
                                             "period_name",
                                             "value",
                                             "area_code",
                                             "area_name",
                                             "area_display_level",
                                             "area_selectable",
                                             "area_sort_sequence",
                                             "item_code",
                                             "item_name",
                                             "item_display_level",
                                             "item_selectable",
                                             "item_sort_sequence",
                                             "seasonal",
                                             "periodicity_code",
                                             "periodicity_name",
                                             "base_code",
                                             "base_name",
                                             "base_period")) %>% 
                                    group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                    summarise(cpi_value = sum(value))
#cu_emp_data_USTransportation_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Transportation and warehousing
#EMP_DAT_CAT_SAN_USTransportation_NY = EMP_DAT_CAT_SAN_NY %>%
#                                        filter(LineCode %in% c(800,801,802,803,804,805,806,807,808,809,811)) %>%
#                                        mutate(parent_line_code = 800)

cpi_emp_data_USTransportation_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USTransportation_OR, 
                                         by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USTransportation_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Medical

### NY - New York

```{r CpiEmpMedicalNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_NY = cu_data_USMedical %>% 
                            filter(area_name=="New York-Northern New Jersey-Long Island", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600) %>% 
                            select(c("parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = sum(value))
#cu_emp_data_USMedical_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Health care and social assistance
#EMP_DAT_CAT_SAN_USTransportation_NY = EMP_DAT_CAT_SAN_NY %>%
#                                        filter(LineCode %in% c(1600,1601,1602,1603,1604)) %>%
#                                        mutate(parent_line_code = 1600)

cpi_emp_data_USMedical_NY = merge(EMP_DAT_CAT_SAN_NY, cu_emp_data_USMedical_NY, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan

```{r CpiEmpMedicalMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_MI = cu_data_USMedical %>% 
                            filter(area_name=="Detroit-Ann Arbor-Flint", 
                                   period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600) %>% 
                            select(c("parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = sum(value))
#cu_emp_data_USMedical_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Health care and social assistance
#EMP_DAT_CAT_SAN_USTransportation_NY = EMP_DAT_CAT_SAN_NY %>%
#                                        filter(LineCode %in% c(1600,1601,1602,1603,1604)) %>%
#                                        mutate(parent_line_code = 1600)

cpi_emp_data_USMedical_MI = merge(EMP_DAT_CAT_SAN_MI, cu_emp_data_USMedical_MI, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon

```{r CpiEmpMedicalOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_emp_data_USMedical_OR = cu_data_USMedical %>% 
                            filter(area_name=="Portland-Salem", 
                                   period %in% c("S01","S02")) %>% 
                            mutate(parent_item_code = 'SAM', 
                                   emp_line_code = 1600) %>% 
                            select(c("parent_item_code",
                                     "emp_line_code",
                                     "series_id",
                                     "series_title",
                                     "year",
                                     "period",
                                     "period_abbr",
                                     "period_name",
                                     "value",
                                     "area_code",
                                     "area_name",
                                     "area_display_level",
                                     "area_selectable",
                                     "area_sort_sequence",
                                     "item_code",
                                     "item_name",
                                     "item_display_level",
                                     "item_selectable",
                                     "item_sort_sequence",
                                     "seasonal",
                                     "periodicity_code",
                                     "periodicity_name",
                                     "base_code",
                                     "base_name",
                                     "base_period")) %>% 
                            group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                            summarise(cpi_value = sum(value))
#cu_emp_data_USMedical_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Health care and social assistance
#EMP_DAT_CAT_SAN_USTransportation_NY = EMP_DAT_CAT_SAN_NY %>%
#                                        filter(LineCode %in% c(1600,1601,1602,1603,1604)) %>%
#                                        mutate(parent_line_code = 1600)

cpi_emp_data_USMedical_OR = merge(EMP_DAT_CAT_SAN_OR, cu_emp_data_USMedical_OR, 
                                  by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USMedical_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

## Education & Communication

### NY - New York

```{r CpiEmpEduCommNY, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_NY = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="New York-Northern New Jersey-Long Island", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', emp_line_code = 1500) %>% 
                                          select(c("parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = sum(value))
#cu_data_USEducationAndCommunication_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Educational services
#EMP_DAT_CAT_SAN_USEducationAndCommunication_NY = EMP_DAT_CAT_SAN_NY %>%
#                                                   filter(LineCode %in% c(1500)) %>%
#                                                   mutate(parent_line_code = 1500)

cpi_emp_data_USEducationAndCommunication_NY = merge(EMP_DAT_CAT_SAN_NY, cu_data_USEducationAndCommunication_NY, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_NY %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### MI - Michigan

```{r CpiEmpEduCommMI, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_MI = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Detroit-Ann Arbor-Flint", 
                                                 period %in% c("M01","M02","M03","M04","M05","M06","M07","M08","M09","M10","M11","M12")) %>% 
                                          mutate(parent_item_code = 'SAE', emp_line_code = 1500) %>% 
                                          select(c("parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = sum(value))
#cu_data_USEducationAndCommunication_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Educational services
#EMP_DAT_CAT_SAN_USEducationAndCommunication_NY = EMP_DAT_CAT_SAN_NY %>%
#                                                   filter(LineCode %in% c(1500)) %>%
#                                                   mutate(parent_line_code = 1500)

cpi_emp_data_USEducationAndCommunication_MI = merge(EMP_DAT_CAT_SAN_MI, cu_data_USEducationAndCommunication_MI, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_MI %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

### OR - Oregon

```{r CpiEmpEduCommOR, include=TRUE, eval=TRUE, message=FALSE, warning=FALSE, echo=TRUE, results='show'}
cu_data_USEducationAndCommunication_OR = cu_data_USEducationAndCommunication %>% 
                                          filter(area_name=="Portland-Salem", 
                                                 period %in% c("S01","S02")) %>% 
                                          mutate(parent_item_code = 'SAE', emp_line_code = 1500) %>% 
                                          select(c("parent_item_code",
                                                   "emp_line_code",
                                                   "series_id",
                                                   "series_title",
                                                   "year",
                                                   "period",
                                                   "period_abbr",
                                                   "period_name",
                                                   "value",
                                                   "area_code",
                                                   "area_name",
                                                   "area_display_level",
                                                   "area_selectable",
                                                   "area_sort_sequence",
                                                   "item_code",
                                                   "item_name",
                                                   "item_display_level",
                                                   "item_selectable",
                                                   "item_sort_sequence",
                                                   "seasonal",
                                                   "periodicity_code",
                                                   "periodicity_name",
                                                   "base_code",
                                                   "base_name",
                                                   "base_period")) %>% 
                                          group_by(parent_item_code, emp_line_code, year, area_code, area_name) %>% 
                                          summarise(cpi_value = sum(value))
#cu_data_USEducationAndCommunication_NY %>%
#  sample_frac(0.33) %>% 
#  DT::datatable()

#Educational services
#EMP_DAT_CAT_SAN_USEducationAndCommunication_NY = EMP_DAT_CAT_SAN_NY %>%
#                                                   filter(LineCode %in% c(1500)) %>%
#                                                   mutate(parent_line_code = 1500)

cpi_emp_data_USEducationAndCommunication_OR = merge(EMP_DAT_CAT_SAN_OR, cu_data_USEducationAndCommunication_OR, 
                                                    by.x=c("LineCode","Year"), by.y=c("emp_line_code","year"))

cpi_emp_data_USEducationAndCommunication_OR %>%
#  sample_frac(0.33) %>% 
  DT::datatable()
```

# References
- [How to import multiple .csv files at once?](https://stackoverflow.com/questions/11433432/how-to-import-multiple-csv-files-at-once)
